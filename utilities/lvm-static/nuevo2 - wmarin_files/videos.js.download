var _____WB$wombat$assign$function_____ = function(name) {return (self._wb_wombat && self._wb_wombat.local_init && self._wb_wombat.local_init(name)) || self[name]; };
if (!self.__WB_pmw) { self.__WB_pmw = function(obj) { this.__WB_source = obj; return this; } }
{
  let window = _____WB$wombat$assign$function_____("window");
  let self = _____WB$wombat$assign$function_____("self");
  let document = _____WB$wombat$assign$function_____("document");
  let location = _____WB$wombat$assign$function_____("location");
  let top = _____WB$wombat$assign$function_____("top");
  let parent = _____WB$wombat$assign$function_____("parent");
  let frames = _____WB$wombat$assign$function_____("frames");
  let opener = _____WB$wombat$assign$function_____("opener");

(function(e){var c=function(k,l){var m=this;this.aside_block_class="aside-block-collaborators";this.template='<div class="aside-block '+this.aside_block_class+'"><div class="content"></div></div>';this.$el=e(this.template);this.movieId=k;this.accessId=l;this.invite_candidates=[];this.$el.on("click",'[data-action="collaborator-invite"]',function(n){n.preventDefault();e("#modal-collaborators-invite").find(".modal-form").removeClass("modal-producer modal-reviewer").addClass("modal-"+e(this).data("role")).end().find('select[name="role"]').val(e(this).data("role")).end().modal()}).on("click",'[data-action="collaborator-remove"]',function(n){n.preventDefault();e("#modal-collaborators-remove").find('input[name="role"]').val(e(this).data("type")).end().find('input[name="user"]').val(e(this).data("user")).end().find('input[name="clb_uid"]').val(e(this).data("unique-id")).end().modal()});e(document).on("submit","#modal-collaborators-remove form",function(o){var n=e(this);o.preventDefault();m.remove(e("#modal-collaborators-remove"),n.find('input[name="role"]').val(),n.find('input[name="clb_uid"]').val())}).on("submit","#modal-collaborators-invite form",function(n){n.preventDefault();m.invite(e("#modal-collaborators-invite"))}).on("shown","#modal-collaborators-invite",function(){var n=e(this);if(n.find('input[name="user_token"]').data("bs.tokenfield")){n.find('input[name="user_token"]').tokenfield("destroy")}n.find('input[name="user_token"]').val("").on("tokenfield:preparetoken",function(o){var p=m.invite_candidates;if(!m.isEmail(o.token.value)){for(key in p){if(o.token.value==p[key].label){o.token.value=p[key].value;o.token.label=p[key].label;return}}}else{for(key in p){if(o.token.value==p[key].value){o.token.label=p[key].label;return}}}}).on("tokenfield:createtoken",function(p){if("producer"==e(p.target).parents("form").find('[name="role"]').val()){var q=m.invite_candidates;var o=false;for(key in q){if(p.token.value==q[key].value){o=true;break}}if(!o){e(p.relatedTarget).addClass("invalid")}else{e(p.relatedTarget).addClass("valid")}}else{if(!m.isEmail(p.token.value)){e(p.relatedTarget).addClass("invalid")}else{e(p.relatedTarget).addClass("valid")}}}).on("tokenfield:startedit",function(p){var o=e.Event("change");o.initiator="tokenfield";e(p.target).trigger(o)}).on("tokenfield:removetoken",function(o){e(o.target).trigger("change")}).on("change",function(o){e(o.target).parents(".form-row").removeClass("error");if(e(o.target).val()){if(0==e(o.target).tokenfield("getTokens",".invalid").length){e(o.target).parents("form").find('[type="submit"]').prop("disabled",false)}else{e(o.target).parents("form").find('[type="submit"]').prop("disabled",true);e(o.target).parents(".form-row").addClass("error")}}else{e(o.target).parents("form").find('[type="submit"]').prop("disabled",true)}}).tokenfield({createTokensOnBlur:true,beautify:false,autocomplete:{source:m.invite_candidates,delay:100},showAutocompleteOnFocus:true});n.find('select[name="role"]').on("change",function(){n.find(".modal-form").removeClass("modal-producer modal-reviewer").addClass("modal-"+e(this).val());n.find('input[name="user_token"]').tokenfield("setTokens",n.find('input[name="user_token"]').tokenfield("getTokens"))})}).on("hidden","#modal-collaborators-invite",function(){e(this).find('form [type="reset"]').click()}).on("click","#modal-collaborators-invite form .add-message a",function(){e("#modal-collaborators-invite form .add-message").hide();e("#modal-collaborators-invite form .additional-message").show();return false}).on("click","#modal-collaborators-invite form .remove-message a",function(){e("#modal-collaborators-invite form .additional-message").hide();e('#modal-collaborators-invite form .additional-message [name="message"]').val("");e("#modal-collaborators-invite form .add-message").show();return false}).on("click",'#modal-collaborators-invite form [type="reset"]',function(){e(this).hide().parents("form").find('[name="message"]').val("").end().find('[type="submit"]').prop("disabled",true).show().end().find(".alert").remove();e(this).parents("form")[0].reset();return false});this.initialize()};c.prototype={initialize:function(){this.loadCandidates();this.show()},load:function(){var l="/ajax/getCollaborators/"+this.movieId+"/"+this.accessId,k=this.$el.find(".content");k.empty().addClass("loading");e.post(l,function(m){k.removeClass("loading").html(m)});this.show()},show:function(){e("#video-page").addClass("player-expand");var k=e("#player-aside").find(".aside-block."+this.aside_block_class);if(k.length){k.siblings().hide().end().show()}else{e("#player-aside").find(".aside-block").hide();e("#player-aside").append(this.$el)}return this},hide:function(){e("#player-aside").find(".aside-block").hide();e("#video-page").removeClass("player-expand");return this},alert:function(l,m,k){k=k||"success";l.find(".alert").remove();var n=e('<div class="alert"><button type="button" class="close" data-dismiss="alert">&times;</button></div>');n.addClass("alert-"+k).append(m).prependTo(l.find(".modal-body"))},invite:function(k){var l=this;k.find(".alert").remove();var m=l.invite_candidates;var n=[];e.each(k.find("form").find('input[name="user_token"]').tokenfield("getTokens",".valid"),function(o,q){var p=false;for(key in m){if(q.value==m[key].value){n.push(m[key].b_value);p=true;break}}if(!p){n.push(q.value)}});k.find("form").find('input[name="raw_user_token"]').val(n.join(","));k.find("form").find('[type="submit"]').hide().end().find('.sending[type="button"]').show().end();e.post("/ajax/inviteCollaborators",k.find("form").serialize(),function(o){k.find("form").find('.sending[type="button"]').hide().end().find('[type="submit"]').show().end();if(o.error){l.alert(k,o.error,"error");return}l.alert(k,o.msg);k.find("form").find('input[name="raw_user_token"]').val("").end().find('[name="message"]').val("").end().find('input[name="user_token"]').val("").tokenfield("setTokens",true,false);k.modal("hide");l.load()},"json")},remove:function(k,o,n){var l=this;k.find(".alert").remove();var m={movieId:this.movieId,role:o,uniqueId:n};e.post("/ajax/removeCollaborator",m,function(p){if(p.error){return}k.modal("hide");l.load()},"json")},isEmail:function(l){var k=/[a-z0-9!#$%&'*+/=?^_{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/i;return k.test(l)},loadCandidates:function(){var l=this,k="/ajax/getCollaboratorCandidates";e.getJSON(k,function(m){if(m.suc){l.invite_candidates=m.candidates}else{l.invite_candidates=[]}})}};var f={addNote:function(l){var k=e.post("/ajax/addWorknote",l,null,"json");return k},addNoteWOL:function(l){var k=e.post("/ajax/addWorknoteWOL",l,null,"json");return k},addReply:function(l){var k=e.post("/ajax/",l,null,"json");return k},removeNote:function(l){var k=e.post("/ajax/deleteWorknote",l,null,"json");return k},removeNoteWOL:function(l){var k=e.post("/ajax/deleteWorknoteWOL",l,null,"json");return k},resolveNote:function(l){var k=e.post("/ajax/resolveWorknote",l,null,"json");return k}};var d=function(k,l){this.aside_block_class="aside-block-worknotes";this.template='<div class="aside-block '+this.aside_block_class+'"><div class="content"></div></div>';this.$el=e(this.template);this.movieId=k;this.accessId=l||"";this.player=j(e("#playerdiv"));this.scenes=[];this.initialize()};d.prototype={initialize:function(){this.show();var k=this;if(this.player.ready){var l=k.player.getScenesInfo();k.scenes=l||k.scenes}this.player.bind("scene",function(o,n){var m=n.guid;k.highlightScene(m)}).bind("pause play end",function(m){e("#worknotes-module").toggleClass("show-form",!k.player.playing);if(m.type=="end"){k.$el.find('.worknote-post-form [name="scene"]').val("");k.updateNoteTime(false)}if(!k.player.playing){k.$el.find('.worknote-post-form [name="note_body"]').focus()}}).bind("ready",function(){var m=k.player.getScenesInfo();k.scenes=m||k.scenes;k.highlightScene(k.player.getSceneGuid());k.processScenesInfo()}).bind("reset",function(){});this.$el.on("click",".worknotes-container .scene-note-header",function(n){n.preventDefault();var m=e(this).closest(".scene-note");k.seekToScene(m)}).on("click",'[data-action="note-reply"]',function(n){n.preventDefault();var m=e(this).closest(".scene-note").data("scene-id");var o=e(this).closest(".worknote").data("note-id");k.showReply(m,o)}).on("click",'[data-action="note-reply-dismiss"]',function(){k.hideReply()}).on("click",'[data-action="note-resolve"]',function(o){o.preventDefault();var m=(e(this).data("status")=="new")?0:1;var n={mid:k.movieId,aid:k.accessId,noteId:e(this).closest(".worknote").data("note-id"),reopen:m};k.resolveNote(n)}).on("click",'[data-action="note-delete"]',function(n){n.preventDefault();if(!confirm(GT.gettext("Are you sure you have to delete this note?"))){return}var m={mid:k.movieId,aid:k.accessId,noteId:e(this).closest(".worknote").data("note-id")};k.removeNote(m)}).on("click",'[data-action="show-add-note"]',function(m){m.preventDefault();if(k.player.playing){k.player.pause();k.player.trigger("pause")}}).on("submit",".worknote-post-form, .worknote-reply-form",function(o){o.preventDefault();var m=e(this);var n=e(this).serializeArray();n.push({name:"mid",value:k.movieId},{name:"aid",value:k.accessId});if(m.hasClass("worknote-post-form")){k.addNote(e.param(n))}else{k.addReply(e.param(n))}})},show:function(){e("#video-page").addClass("player-expand");var k=e("#player-aside").find(".aside-block."+this.aside_block_class);if(k.length){k.siblings().hide().end().show()}else{e("#player-aside").find(".aside-block").hide();e("#player-aside").append(this.$el)}return this},hide:function(){e("#player-aside").find(".aside-block").hide();e("#video-page").removeClass("player-expand");return this},showReply:function(k,p){var m=this.$el.find(".worknote-reply-wrapper");var o=this.$el.find(".worknote-reply-form");var n=e("<div />").addClass("scene-note");var l=e("#worknote_"+p).clone().removeAttr("id");e("#scene-note_"+k+" .scene-note-header").clone().appendTo(n);n.append('<div class="worknote-separator"></div>');l.find(".worknote-actions").remove();n.append(l);m.find(".scene-note").remove();n.insertBefore(o);o.find('[name="scene"]').val(k).end().find('[name="pnote"]').val(p);m.fadeIn();o.find('[name="note_body"]').focus();e("body").on("click",e.proxy(this.hideReply,this))},hideReply:function(k){if(k&&e(k.target).closest(".worknotes-module").length){return}this.$el.find(".worknote-reply-form").form("reset");this.$el.find(".worknote-reply-wrapper").fadeOut();e("body").off("click",e.proxy(this.hideReply,this))},load:function(){var m=this,l="/ajax/getWorknotesPanel/"+this.movieId,k=this.$el.find(".content");if(this.accessId){l+="/"+this.accessId}k.empty().addClass("loading");e.post(l,function(o){k.removeClass("loading").html(o);if(m.player.ready){var n=m.player.getSceneGuid();if(n!=""){m.highlightScene(n)}}m.processScenesInfo()});this.show()},processScenesInfo:function(){var k=this;e.each(this.scenes,function(l,n){var m="<b>~"+n.startFrom.toFixed(1)+"s</b> [Scene "+(l+1)+"]";e("#scene-note_"+n.guid,k.$el).find(".scene-note-header").html(m)})},seekToScene:function(k){if(this.player.ready){this.player.seekScene(k.data("sceneId"));if((!this.player.paused)&&(!this.player.playing)&&this.scenes.length&&(k.data("sceneId")==this.scenes[this.scenes.length-1].guid)){this.highlightScene(k.data("sceneId"))}}},highlightScene:function(k){var l=this.$el.find("#scene-note_"+k);if(l.length){l.siblings().removeClass("active").end().addClass("active");if(this.$el.find("#scene-note_"+k+":visible").length){e("#worknotes-container").stop().scrollTo(l,400)}}else{e("#worknotes-container").stop().scrollTo(l,0)}this.$el.find('.worknote-post-form [name="scene"]').val(k);this.updateNoteTime(k)},addNote:function(m){var l=this,k=null;if(this.accessId==""){k=f.addNote(m)}else{k=f.addNoteWOL(m)}k.done(function(n){if(n.suc){l.$el.find("#scene-note_"+n.scene+" .scene-note-body").html(n.tmpl);l.$el.find(".worknote-post-form")[0].reset();l.$el.find("#scene-note_"+n.scene).show();e(".worknotes-num").text(parseInt(e(".worknotes-num").text(),10)+1);e("#worknotes-container").removeClass("empty")}else{if(n.message){showNotice(n.message,true)}}})},removeNote:function(l){var k=null;if(this.accessId==""){k=f.removeNote(l)}else{k=f.removeNoteWOL(l)}k.done(function(m){if(m.suc){var n=e("#worknote_"+l.noteId).closest(".scene-note");e("#worknote_"+l.noteId).prev(".worknote-separator").remove().end().remove();if(n.find(".worknote").length<1){n.hide()}e(".worknotes-num").text(parseInt(e(".worknotes-num").text(),10)-1);e("#worknotes-container").toggleClass("empty",e(".scene-note:visible").length==0)}else{if(m.message){showNotice(m.message,true)}}})},resolveNote:function(l){var k=f.resolveNote(l);k.done(function(m){if(m.suc){e("#worknote_"+l.noteId).find('.worknote-actions [data-action="note-resolve"]').data("status",m.status).find("span.note-label-"+("resolved"==m.status?"resolve":"reopen")).hide().end().find("span.note-label-"+("resolved"==m.status?"reopen":"resolve")).show().end().end().toggleClass("dim");if(l.reopen_flag){e(".worknotes-num").text(parseInt(e(".worknotes-num").text(),10)+1)}else{e(".worknotes-num").text(parseInt(e(".worknotes-num").text(),10)-1)}}else{if(m.message){showNotice(m.message,true)}}})},addReply:function(m){var l=this,k=null;if(this.accessId==""){k=f.addNote(m)}else{k=f.addNoteWOL(m)}k.done(function(n){if(n.suc){l.$el.find("#scene-note_"+n.scene+" .scene-note-body").html(n.tmpl);l.$el.find("#scene-note_"+n.scene).show();l.$el.find(".worknote-reply-form")[0].reset();l.$el.find('.worknote-reply-form [name="pnote"]').val("");l.hideReply()}else{if(n.message){showNotice(n.message,true)}}})},updateNoteTime:function(m){var l="none";if(m){for(var n=0,k=this.scenes.length;n<k;++n){if(this.scenes[n].guid==m){l="~"+this.scenes[n].startFrom.toFixed(1)+"s";break}}}e("#worknotes-module .worknotes-module-top .note-timestamp").html("<b>"+l+"</b>")}};var j=function(n){var m;function k(){m="go"+(""+Math.random()).slice(3,15);e[m]=function(q,p){var r=e.Event(q);setTimeout(function(){n.trigger(r,p)},1)};l.bind("play pause end",function(p){if(p.type=="play"){l.playing=true;l.paused=false}else{if(p.type=="pause"){l.paused=true;l.playing=false}else{if(p.type=="end"){l.paused=false;l.playing=false}}}}).bind("ready",function(){l.ready=true})}var o=n.data("playerApi");var l=o||{ready:false,paused:false,playing:false,bind:function(q,p){n.bind(q,p);return l},one:function(q,p){n.one(q,p);return l},unbind:function(q,p){n.unbind(q,p);return l},trigger:function(q,p){n.trigger(q,[l,p]);return l},reset:function(){l.paused=false;l.playing=false;l.ready=false;return l.trigger("reset")},bindPlayerEvents:function(){var p="jQuery."+m,q=l.getPlayer();q.bind("ready",p);q.bind("play",p);q.bind("pause",p);q.bind("end",p);q.bind("scene",p);return l},unbindPlayerEvents:function(){var p="jQuery."+m,q=l.getPlayer();q.unbind("ready",p);q.unbind("play",p);q.unbind("pause",p);q.unbind("end",p);q.unbind("scene",p);return l},getPlayer:function(){return e("object",n)[0]},getScenesInfo:function(){return l.getPlayer().getSceneInfoArray()},getSceneGuid:function(){return l.getPlayer().getSceneGuid()},seek:function(p){return l.getPlayer().seek(p)},seekScene:function(p){return l.getPlayer().seekScene(p)},pause:function(){return l.getPlayer().pause()}};if(!n.data("playerApi")){k()}n.data("playerApi",l);return l};var i=function(k){var l=this;this.aside_block_class="aside-block-revision-history";this.template='<div class="aside-block '+this.aside_block_class+'"><div class="header"><button class="close">&#215;</button><h3>'+GT.gettext("Revision History")+'</h3></div><div class="content"></div></div>';this.$el=e(this.template);this.movieId=k;this.revisionTS="";this.$el.on("click",".close",function(m){m.preventDefault();l.hide()});this.initialize()};i.prototype={initialize:function(){this.show();this.loadRevisions()},load:function(){this.loadRevisions();this.show()},loadRevisions:function(){var m=this,l="/ajax/getMovieRevisionList/"+this.movieId,k=this.$el.find(".content");this.revisionTS="";k.empty().addClass("loading");e.post(l,function(o){if(!o.length){return}var n=m.renderRevisions(o);k.removeClass("loading").append(n);n.find(".revision.active").click()},"json")},renderRevisions:function(n){var m=this,l=e('<ol class="revisions"></ol>'),k=(typeof MOVIE_COLLAB_LOCK!="undefined"&&MOVIE_COLLAB_LOCK)?true:false;e.each(n,function(q,p){var o=e('<li class="revision"></li>').data("timestamp",p.timestamp);if(p.type=="current"){m.revisionTS=p.timestamp;o.addClass("active")}o.append(e("<strong></strong>").text(p.EST));if(p.type=="autosave"){o.append('<br><small class="autosave">autosave</small>')}else{if((typeof p.save_by!="undefined")&&p.save_by){if((typeof USER_USERNAME!="undefined")&&USER_USERNAME&&USER_USERNAME==p.save_by){o.append("<br><small>saved by you</small>")}else{o.append("<br><small>saved by "+p.save_by+"</small>")}}else{o.append("<br><small>saved by you</small>")}}o.append('<div class="actions dimmed"><a class="play" href="#"><i class="ico-play"></i></a>'+(k?"":' <a class="edit" href="#"><i class="ico-edit"></i></a> <a class="copy" href="#"><i class="ico-copy"></i></a>')+"</div>");o.on("click",function(){var s=o.find("strong").text(),r=o.find("small").text();if(p.type=="current"){s=GT.gettext("Latest revision")}m.setHeader(s,r);if(!o.hasClass("active")){m.setPlayer(p.timestamp,p.type,false);l.find(".active").removeClass("active");o.addClass("active")}}).on("click",".edit",function(r){r.preventDefault();r.stopPropagation();if(p.type=="autosave"){fullscreenStudio("/videomaker/full/editasrevision/"+m.movieId+"/"+p.timestamp)}else{fullscreenStudio("/videomaker/full/editrevision/"+m.movieId+"/"+p.timestamp)}}).on("click",".copy",function(r){r.preventDefault();r.stopPropagation();if(p.type=="autosave"){fullscreenStudio("/videomaker/full/copyasrevision/"+m.movieId+"/"+p.timestamp)}else{fullscreenStudio("/videomaker/full/copyrevision/"+m.movieId+"/"+p.timestamp)}}).on("click",".play",function(r){r.preventDefault();r.stopPropagation();m.setPlayer(p.timestamp,p.type,true);l.find(".active").removeClass("active");o.addClass("active")}).appendTo(l)});return l},setPlayer:function(m,o,l){var p=e("#playerdiv object param[name='flashvars']");var n=p.attr("value");if(l==true){if(n.search("&autostart=")==-1){n+="&autostart=1"}n=n.replace("&autostart=0","&autostart=1")}else{if(n.search("&autostart=")==-1){n+="&autostart=0"}n=n.replace("&autostart=1","&autostart=0")}if(n.search("&revaction=")!=-1){n=n.substr(0,n.search("&revaction="))}if(o=="autosave"){n+="&revaction=e&revts="+m+"&revtype=a"}else{n+="&revaction=e&revts="+m+"&revtype=m"}p.attr("value",n);var k=e("#playerdiv object").clone();e("#playerdiv object").remove();k.appendTo("#playerdiv")},setHeader:function(l,k){e(".video-header").empty().append(e("<h1></h1>").text(l)).append(e("<span></span>").text(k)).show()},show:function(){e("#video-page").addClass("player-expand");var k=e("#player-aside").find(".aside-block."+this.aside_block_class);if(k.length){k.siblings().hide().end().show()}else{e("#player-aside").find(".aside-block").hide();e("#player-aside").append(this.$el)}e(".video-actions").hide();e(".video-license").hide()},hide:function(){if(e(".video-top-nav").find(".active").length){e("#player-aside").find(".aside-block."+this.aside_block_class).hide();e(".video-top-nav").find(".active a").trigger("restore")}else{e("#player-aside").find(".aside-block").hide();e("#video-page").removeClass("player-expand")}if(this.revisionTS!=""){this.setPlayer(this.revisionTS,"current",false)}e(".video-actions").show();e(".video-license").show();e(".video-header").hide();e(document).trigger("revisionHistoryHidden")}};var a=function(k){var l=this;this.$el=k;this.$el.click(function(o){var n=e(this),m=n.data("userId");o.preventDefault();if(n.hasClass("not-following")){l.follow(m)}else{if(n.hasClass("following")){l.unfollow(m)}}}).mouseleave(function(){e(this).removeClass("cancel-hover")})};a.prototype={follow:function(l){var m=this,k="/ajax/becomeFan/"+l;e.post(k,function(n){parseResponse(n);if(responseArray.code=="0"){m.setState("following");m.$el.addClass("cancel-hover")}resetResponse()})},unfollow:function(l){var m=this,k="/ajax/removeIdol/"+l;e.post(k,function(n){parseResponse(n);if(responseArray.code=="0"){m.setState("not-following")}resetResponse()})},setState:function(k){this.$el.removeClass("following not-following").addClass(k)}};var b={follow:function(l,n){var m=this,k="/ajax/becomeFan/"+l;e.post(k,function(o){parseResponse(o);if(responseArray.code=="0"){if(n){m.setState(n,"following")}}resetResponse()})},unfollow:function(l,n){var m=this,k="/ajax/removeIdol/"+l;e.post(k,function(o){parseResponse(o);if(responseArray.code=="0"){if(n){m.setState(n,"not-following")}}resetResponse()})},setState:function(k,l){k.removeClass("following not-following").addClass(l)}};var g=function(k){var l=this;this.$el=k;this.$el.click(function(o){var n=e(this),m=n.data("video");o.preventDefault();if(n.hasClass("not-liked")){l.like(m)}else{if(n.hasClass("liked")){l.unlike(m)}}}).mouseleave(function(){e(this).removeClass("cancel-hover")})};g.prototype={like:function(m){var l=this,k="/ajax/movie_recommend";e.post(k,{movie_id:m},function(n){parseResponse(n);if(responseArray.code=="0"){l.setState("liked");l.$el.addClass("cancel-hover")}resetResponse()})},unlike:function(m){var l=this,k="/ajax/deleteFavorite/"+m;e.post(k,function(n){parseResponse(n);if(responseArray.code=="0"){l.setState("not-liked")}resetResponse()})},setState:function(k){this.$el.removeClass("liked not-liked").addClass(k)}};var h=function(k){var l=this;this.$el=e(k);this.revisionHistory=null;this.collaborators=null;this.worknoteModule=null;this.playerApi=null;if(playerApiReady){this.playerApi=j(e("#playerdiv"));this.playerApi.bindPlayerEvents().reset()}e(document).on("published","#video-share",function(n,m){l.updateInfo(m)}).on("saved","#video-settings",function(n,m){l.updateInfo(m)}).on("commentPosted",function(){e(".num-commented").html(number_format(parseInt(e(".num-commented").html(),10)+1))}).on("commentDeleted",function(){e(".num-commented").html(number_format(parseInt(e(".num-commented").html(),10)-1))}).on("videoDeleted",function(){window.location="/dashboard/videos"}).on("click",'[data-action="video-revisions"]',function(o){var n=e(this),m=n.data("video");o.preventDefault();e("#video-edit").modal("hide");if(!l.revisionHistory){l.revisionHistory=new i(m)}else{l.revisionHistory.load()}}).on("click restore",'[data-action="video-collaboration"]',function(q){var p=e(this),o=p.data("video"),m=p.data("accessId");q.preventDefault();if(!l.collaborators){l.collaborators=new c(o,m)}if(q.type=="restore"){l.collaborators.load();return}var n=l.activeAsideNav(p);if(n){l.collaborators.load()}else{l.collaborators.hide()}}).on("click restore",'[data-action="video-worknotes"]',function(q){var p=e(this),o=p.data("video"),m=p.data("accessId");q.preventDefault();if(!l.worknoteModule){l.worknoteModule=new d(o,m)}if(q.type=="restore"){l.worknoteModule.load();return}var n=l.activeAsideNav(p);if(n){l.worknoteModule.load()}else{l.worknoteModule.hide()}}).on("playerApiReady",function(){this.playerApi=j(e("#playerdiv"));this.playerApi.bindPlayerEvents().reset()})};h.prototype={updateInfo:function(k){this.$el.find(".video-top .status").attr("class","status "+k.status);this.$el.find(".video-top h1").text(k.title);if("draft"==k.status){this.$el.find(".video-social-share").hide()}else{this.$el.find(".video-social-share").show()}},activeAsideNav:function(k){var l=k.parent();if(l.hasClass("active")){l.removeClass("active");return false}l.siblings().removeClass("active").end().addClass("active");return true}};e(document).ready(function(){e(".follow-button").each(function(){var n=e(this);if(!n.data("followButton")){n.data("followButton",new a(n))}});e(".favorite-button").each(function(){var n=e(this);if(!n.data("favoriteButton")){n.data("favoriteButton",new g(n))}});var m=new h("#video-page");if(typeof hasRevisionHistory!="undefined"&&hasRevisionHistory==true&&typeof revisionEncMovieId!="undefined"){var l=new i(revisionEncMovieId)}e('[rel="tooltip"]').tooltip();function k(p,n,o){e(p).addClass("loading");e.post(n,{page:o},function(q){e.scrollTo(p,{duration:200,offset:{top:-20}});e(p).replaceWith(q)})}e("#video-favorites").on("click","[data-page]",function(r){var q=e(this),o=q.data("page"),p=q.closest(".go-pagination").data("target"),n=q.closest(".go-pagination").data("endPoint");r.preventDefault();if(q.parent().hasClass("disabled")){return}k(p,n,o)}).on("submit",".go-pagination-form",function(r){var q=e(this),o=parseInt(q.find('input[name="page"]').val(),10),p=q.closest(".go-pagination").data("target"),n=q.closest(".go-pagination").data("endPoint");r.preventDefault();if(o<=0||o>q.data("maxPage")){alert(GT.gettext("Please input a valid page number"));return}k(p,n,o)})}).on("click",".user-follow-button",function(m){var l=e(this),k=l.data("userId");m.preventDefault();if(l.hasClass("not-following")){b.follow(k,l)}else{if(l.hasClass("following")){b.unfollow(k,l)}}})})(jQuery);var URL_STAFFPICKS_MOVIE="/ajax/addStaffpicksMovie";var URL_ADD_BEST_ANIMATION="/ajax/addBestAnimation";var URL_ADD_FEATUED_ANIMATION="/ajax/addFeaturedAnimation";var URL_REJECT_MOVIE="/ajax/rejectMovie";var URL_SET_TITLE_PREFIX="/ajax/setMovieTitlePrefix";function staffpicksMovie(a){var b="Are you sure to Staffpicks this video?";if(!confirm(b)){return}$.post(URL_STAFFPICKS_MOVIE+"/"+a,function(c){parseResponse(c);if(typeof responseArray.json.url!="undefined"){window.location=responseArray.json.url}else{if(responseArray.code=="0"){displayFeedback(responseArray.code+"The video has been added to Staffpicks")}else{displayFeedback(responseArray.code+responseArray.json.error)}}resetResponse()})}function addBestAnimation(a){var b="Are you sure to add this video as one of the best animations?";if(!confirm(b)){return}$.post(URL_ADD_BEST_ANIMATION+"/"+a,function(c){parseResponse(c);if(typeof responseArray.json.url!="undefined"){window.location=responseArray.json.url}else{if(responseArray.code=="0"){displayFeedback(responseArray.code+"The video is one of the best animations now")}else{displayFeedback(responseArray.code+responseArray.json.error)}}resetResponse()})}function featureAnimation(a){var b="Are you sure to feature this video?";if(!confirm(b)){return}$.post(URL_ADD_FEATUED_ANIMATION+"/"+a,function(c){parseResponse(c);if(typeof responseArray.json.url!="undefined"){window.location=responseArray.json.url}else{if(responseArray.code=="0"){displayFeedback(responseArray.code+"The video has been added as featured animation")}else{displayFeedback(responseArray.code+responseArray.json.error)}}resetResponse()})}function rejectMovie(b){var c="Are you sure you want to reject this video?";if(!confirm(c)){return}var a=URL_REJECT_MOVIE+"/"+b;jQuery.post(a,function(d){parseResponse(d);if(typeof responseArray.json.url!="undefined"){window.location=responseArray.json.url}else{if(responseArray.code=="0"){displayFeedback(responseArray.code+"Video has been rejected")}else{displayFeedback(responseArray.code+responseArray.json.error)}}resetResponse()})}function setMovieTitlePrefix(b){if(typeof MOVIE_TITLE==="undefined"||typeof MOVIE_USERNAME==="undefined"||typeof MOVIE_TITLE_PREFIX==="undefined"){return false}var e=MOVIE_TITLE+" - "+MOVIE_USERNAME;var d=MOVIE_TITLE_PREFIX;var c=prompt("Enter title prefix for this movie",d);if(c!=null&&c!=d){var a=URL_SET_TITLE_PREFIX+"/"+b;jQuery.post(a,{prefix:c},function(f){parseResponse(f);if(responseArray.code=="0"){displayFeedback(responseArray.code+"Title prefix has been updated.");MOVIE_TITLE_PREFIX=c;document.title=(c!="")?c+" - "+e:e}else{displayFeedback(responseArray.code+responseArray.json.error)}resetResponse()})}};

}
/*
     FILE ARCHIVED ON 23:52:54 Apr 21, 2014 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 17:24:57 Mar 27, 2022.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
*/
/*
playback timings (ms):
  captures_list: 153.586
  exclusion.robots: 0.104
  exclusion.robots.policy: 0.096
  RedisCDXSource: 1.561
  esindex: 0.009
  LoadShardBlock: 132.86 (3)
  PetaboxLoader3.datanode: 132.923 (4)
  CDXLines.iter: 16.759 (3)
  load_resource: 123.721
  PetaboxLoader3.resolve: 69.232
*/