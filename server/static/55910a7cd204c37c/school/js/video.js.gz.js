(function(h,d){var g=function(){};g.create=function(k){var j=h("<div/>").attr({id:k,"class":"modal hide"});return j};g.ensure=function(k){var j=h("#"+k);if(j.length==0){j=g.create(k).appendTo("body")}return j};g.prototype={loading:function(){this.$el.modal("loading")},load:function(j){var k=this;this.$el.modal();this.loading();h.get(j,function(l){k.$el.html(l).modal("layout");k.loading();k.$el.find('[rel="tooltip"]').tooltip({container:k.$el});k.remoteUrl=j;k.$el.trigger("loaded")})},refresh:function(){if(!this.remoteUrl){return}this.load(this.remoteUrl)},alert:function(k,j){j=j||"success";this.$el.find(".alert").remove();var l=h('<div class="alert"><button type="button" class="close" data-dismiss="alert">&times;</button></div>');l.addClass("alert-"+j).append(k).prependTo(this.$el.find(".modal-body"))}};var f=function(j){var k=this;this.$el=j;this.$el.on("submit.video.goanimate",".video-license-form",function(m){var l=h(this);m.preventDefault();k.publish(l.serialize())}).on("click",'[data-action="buttonControl"]',function(n){var m=h(this);var l=true;if(m.data("show")=="#transfer_rights_form"){}else{if(m.data("hide")=="#transfer_rights_form"&&m.data("show")!="#movie_license_enterance"){if(k.validateAddressForm()==true){k.setLicense(h("#movie-license-form").serialize())}else{l=false}k.previewLicense()}else{if(m.data("show")=="#payment_info"){k.showPaymentOverlay(m.data("frame-src"))}}}if(l==true){k.buttonControl(m.data("hide"),m.data("show"))}n.preventDefault()}).on("loaded",function(){k.resetState()})};f.sCountryWithoutZipCodeString="Afghanistan|Angola|Antigua and Barbuda|Aruba|Bahamas|Belize|Benin|Bhutan|Botswana|Burkina Faso|Burundi|Cameroon|Central African Republic|Comoros|Congo|Congo, The Democratic Republic of|Cook Islands|CÃ´te d'Ivoire|Djibouti|Dominica|Equatorial Guinea|Eritrea|Fiji|Gambia|Gibraltar|Grenada|Guinea|Guyana|Hong Kong|Iceland|Kiribati|Korea, Democratic People's Republic of|Macao|Malawi|Mali|Mauritania|Mauritius|Montserrat|Namibia|Nauru|Netherlands Antilles|Niue|Panama|Qatar|Rwanda|Saint Kitts and Nevis|Saint Lucia|Saint Vincent and The Grenadines|Seychelles|Sierra Leone|Solomon Islands|Somalia|Suriname|Tanzania, United Republic of|Tokelau|Tonga|Trinidad and Tobago|Tuvalu|Uganda|United Arab Emirates|Vanuatu|Yemen|Zimbabwe";f.aCountryWithoutZipCode=f.sCountryWithoutZipCodeString.split("|");f.sCanadaStatesString="Alberta|British Columbia|Manitoba|New Brunswick|Newfoundland|Northwest Territories|Nova Scotia|Nunavut|Ontario|Prince Edward Island|Quebec|Saskatchewan|Yukon Territory";f.aCanadaStates=f.sCanadaStatesString.split("|");f.sCanadaStatesCodeString="AB|BC|MB|NB|NL|NT|NS|NU|ON|PE|QC|SK|YT";f.aCanadaStatesCode=f.sCanadaStatesCodeString.split("|");f.sUSAStatesString="Alabama|Alaska|Arizona|Arkansas|California|Colorado|Connecticut|Delaware|District of Columbia|Florida|Georgia|Hawaii|Idaho|Illinois|Indiana|Iowa|Kansas|Kentucky|Louisiana|Maine|Maryland|Massachusetts|Michigan|Minnesota|Mississippi|Missouri|Montana|Nebraska|Nevada|New Hampshire|New Jersey|New Mexico|New York|North Carolina|North Dakota|Ohio|Oklahoma|Oregon|Pennsylvania|Rhode Island|South Carolina|South Dakota|Tennessee|Texas|Utah|Vermont|Virginia|Washington|West Virginia|Wisconsin|Wyoming|Armed Forces Americas|Armed Forces|Armed Forces Pacific";f.aUSAStates=f.sUSAStatesString.split("|");f.sUSAStatesCodeString="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY|AA|AE|AP";f.aUSAStatesCode=f.sUSAStatesCodeString.split("|");f.prototype=h.extend({},g.prototype,{setLicense:function(k){var j=this;this.loading();h.post("/ajax/manageMovieOwner/set",k,function(l){j.loading();if(l.error){j.alert(l.error,"error")}else{formDataArray=k.split("&");for(var m=0;m<formDataArray.length;m++){pair=formDataArray[m].split("=");replace_value=decodeURIComponent(pair[1]);j.$el.find(".u_"+pair[0]).html(replace_value.replace("+"," "))}}},"json")},getLicense:function(){var j=this;this.loading();h.post("/ajax/manageMovieOwner/get",formData,function(k){j.loading();if(k.error){j.alert(k.error,"error")}else{alert(k)}},"json")},buttonControl:function(k,j){this.$el.find(k).hide();this.$el.find(j).show();if(j=="#ending"||j=="#failure"){this.$el.find(".movie_license_header").hide()}else{this.$el.find(".movie_license_header").show()}this.$el.modal("layout")},resetState:function(){var k=this;var l=this.$el.find("#cboCountry :selected").val();var j=this.$el.find("#user_state").val();if(l=="US"){this.$el.find("#input-state").hide();this.$el.find("#input-state").val("");this.$el.find("#cboState").show();k.updateOptions(this.$el.find("#cboState"),f.aUSAStates,f.aUSAStatesCode);this.$el.find("#cboState").val(j)}else{if(l=="CA"){this.$el.find("#input-state").hide();this.$el.find("#input-state").val("");this.$el.find("#cboState").show();k.updateOptions(this.$el.find("#cboState"),f.aCanadaStates,f.aCanadaStatesCode);this.$el.find("#cboState").val(j)}else{this.$el.find("#input-state").show();this.$el.find("#cboState").hide()}}k.updateZip()},toggleCompanyInput:function(){var k=this;var j=this.$el.find('[name="license_type"]:checked').val();if(j=="individual"){this.$el.find("#company_input").hide();this.$el.find('[name="company_name"]').val("")}else{if(j=="company"){this.$el.find("#company_input").show()}}},updateOptions:function(l,k,j){if(l.prop){var m=l.prop("options")}else{var m=l.attr("options")}h("option",l).remove();h.each(k,function(n,o){m[m.length]=new Option(o,j[n])})},updateZip:function(){var j=this;if(j.containsNoZip(this.$el.find("#cboCountry :selected").text())){this.$el.find("#fld_cczipcode").hide();this.$el.find("#cczipcode").val("00000")}else{if(this.$el.find("#cczipcode").val()=="00000"){this.$el.find("#cczipcode").val("")}this.$el.find("#fld_cczipcode").show()}},containsNoZip:function(k){for(var j=0;j<f.aCountryWithoutZipCode.length;j++){if(f.aCountryWithoutZipCode[j]===k){return true}}return false},validateAddressForm:function(){this.$el.find(".form-error").html("");var n=[];var j=this.$el.find('[name="company_name"]').val();var m=this.$el.find('[name="contact_person"]').val();var l=this.$el.find('[name="license_type"]:checked').val();var k=this.$el.find('[name="email"]').val();if(l=="company"){if(j==""){n.push({id:"fld_company_name",msg:GT.gettext("Please input your company name")})}}if(m==""){n.push({id:"fld_contact_person",msg:GT.gettext("Please input the name of your contact person")})}if(k!=""){if(!k.match(/^([\w\!\#$\%\&\'\*\+\-\/\=\?\^\`{\|\}\~]+\.)*[\w\!\#$\%\&\'\*\+\-\/\=\?\^\`{\|\}\~]+@((((([a-z0-9]{1}[a-z0-9\-]{0,62}[a-z0-9]{1})|[a-z])\.)+[a-z]{2,6})|(\d{1,3}\.){3}\d{1,3}(\:\d{1,5})?)$/i)){n.push({id:"fld_email",msg:GT.gettext("Invalid email")})}}for(i=0;i<n.length;i++){content=(n[i].msg);this.$el.find("#"+n[i].id).html(content)}if(n.length>0){return false}else{return true}},previewLicense:function(){var j=this.$el.find('[name="company_name"]').val();var k=this.$el.find('[name="contact_person"]').val();if(j!=""){this.$el.find(".b_contact").html(j)}else{this.$el.find(".b_contact").html(k)}},showPaymentOverlay:function(j){var k=this.$el.find("#payment_info");var l=jQuery("<iframe></iframe>",{id:"cc-payment-iframe",scrolling:"no",allowTransparency:"true",frameborder:"0",width:634,height:647,src:j});this.$el.find(k).html(l)}});var e=function(j){var k=this;this.$el=j;this.$el.on("submit.video.goanimate",".video-publish-form",function(m){var l=h(this);m.preventDefault();k.publish(l.serialize())})};e.prototype=h.extend({},g.prototype,{publish:function(k){var j=this;this.loading();h.post("/ajax/saveMovieSettings",k,function(l){j.loading();if(l.error){j.alert(l.error,"error")}else{j.refresh();j.$el.trigger(h.Event("published"),[l.video])}},"json")}});var c=function(j){this.$el=j};c.prototype=h.extend({},g.prototype,{});var b=function(j,k){var l=this;this.$el=j;this.options=k;this.$el.on("submit.video.goanimate",".video-settings-form",function(n){var m=h(this);n.preventDefault();l.post(m.serialize())})};b.prototype=h.extend({},g.prototype,{post:function(k){var j=this;j.loading();h.post("/ajax/saveMovieSettings",k,function(l){var m=h.Event("saved");j.loading();if(l.error){j.alert(l.error,"error")}else{j.$el.modal("hide");showNotice(GT.gettext("Video settings updated"));j.$el.trigger(m,[l.video])}},"json")}});var a={doDelete:function(j){if(!confirm(GT.gettext("Are you sure you want to delete this video?"))){return}h.post("/ajax/deleteMovie/"+j,function(k){parseResponse(k);if(responseArray.code=="0"){h("#video-"+j).find('[rel="tooltip"]').tooltip("destroy");h("#video-"+j).fadeOut(300,function(){h(this).remove()});h(document).trigger("videoDeleted")}else{showNotice(responseArray.json.error,true)}resetResponse()})},doUnDelete:function(j){h.post("/ajax/undeleteMovie/"+j,function(k){parseResponse(k);if(responseArray.code=="0"){h("#video-"+j).find('[rel="tooltip"]').tooltip("destroy");h("#video-"+j).fadeOut(300,function(){h(this).remove()});h(document).trigger("videoRestored")}else{showNotice(responseArray.json.error,true)}resetResponse()})}};h(document).on("click",'[data-action="video-share"]',function(m){var l=h(this),k=g.ensure("video-share"),j=k.data("videoShare");if(!j){k.data("videoShare",j=new e(k))}m.preventDefault();j.load(l.data("remote"))}).on("click",'[data-action="video-edit"]',function(m){var l=h(this),j=g.ensure("video-edit"),k=j.data("videoEdit");if(!k){j.data("videoEdit",k=new c(j))}m.preventDefault();k.load(l.data("remote"))}).on("click",'[data-action="remove-conversion"]',function(m){var l=h(this),j=g.ensure("video-edit"),k=j.data("videoEdit");enc_movie_id=l.data("video");h.post("/ajax/removePendingConversions/"+enc_movie_id,function(n){if(n.error){k.alert(n.error,"error")}else{k.alert("The conversion process has been cancelled. You can now edit your video. Re-start the conversion process to download/export the most recent version of your video.","success alert-icon");j.find("#video_enabled").show();j.find("#video_disabled").hide()}},"json");m.preventDefault()}).on("click",'[data-action="video-export"]',function(l){var k=h(this),j=g.ensure("video-export"),m=j.data("videoExport");if(!m){j.data("videoExport",m=new VideoExport(j))}l.preventDefault();m.load(k.data("remote"))}).on("click",'[data-action="video-settings"]',function(l){var k=h(this),j=g.ensure("video-settings"),m=j.data("videoSettings");if(!m){j.data("videoSettings",m=new b(j))}l.preventDefault();m.load(k.data("remote"))}).on("click.video.goanimate",'[data-action="video-delete"]',function(j){j.preventDefault();a.doDelete(h(this).data("video"))}).on("click.video.goanimate",'[data-action="video-restore"]',function(j){j.preventDefault();a.doUnDelete(h(this).data("video"))}).on("click.video.goanimate",'[data-action="video-watermark"]',function(j){j.preventDefault();h.post("/ajax/getUserWatermarks/"+h(this).data("video"),function(k){showOverlay(k)})}).on("click",'[data-action="video-license"]',function(m){var l=h(this),j=g.ensure("video-license"),k=j.data("videoLicense");if(!k){j.data("VideoLicense",k=new f(j))}m.preventDefault();k.load(l.data("remote"))}).on("change",'[name="cbo_country"]',function(m){var l=h(this),j=g.ensure("video-license"),k=j.data("videoLicense");if(!k){j.data("VideoLicense",k=new f(j))}m.preventDefault();k.resetState()}).on("change",'[name="license_type"]',function(m){var l=h(this),j=g.ensure("video-license"),k=j.data("videoLicense");if(!k){j.data("VideoLicense",k=new f(j))}m.preventDefault();k.toggleCompanyInput()})})(jQuery,window);function emailShare(a){var b=$("#email-share");if(b.length==0){b=$('<div class="modal" id="email-share"><div class="modal-header"><button class="close" type="button" data-dismiss="modal" aria-hidden="true">&times;</button><h3></h3></div><div class="modal-body"></div></div>');b.find("h3").text(GT.gettext("Share video to your friends"));b.appendTo("body")}var d="/email_a_friend/share_movie/"+a;var c=$('<iframe id="ab" frameborder="0" scrolling="no"></iframe>');c.attr("src",d).css({width:"640px",height:"370px"});b.find(".modal-body").html(c);b.modal()};
