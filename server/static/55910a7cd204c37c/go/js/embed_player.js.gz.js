(function(i,n){var d=20,x=45,m=0.09,h={PAUSED:"paused",PLAYING:"playing",ENDED:"ended"},v={NON_PLAYING:"non-playing",PLAYING:"playing"},q=10,f=200,b=20000,r="Sorry, your video is taking longer than usual to load. <br> Please wait a moment.",l=200,c=1000;var o=(navigator.userAgent.match(/(iPod|iPhone|iPad)/)!==null),t=((navigator.userAgent.indexOf("Safari")>-1)&&(navigator.userAgent.indexOf("Chrome")===-1)),w=t&&(s()<q);var k,p;function s(){var z=navigator.userAgent.match(/version\/([0-9\.]+)/i);return z?parseFloat(z[1]):-1}function j(B,z){var A=false;return function(){if(!A){B.call();A=true;setTimeout(function(){A=false},z)}}}function y(z){i("body").css({"-webkit-touch-callout":z,"-webkit-user-select":z,"-moz-user-select":z,"-ms-user-select":z,"user-select":z})}function u(){var z="ontouchstart" in document.createElement("div");return(z)?true:false}function a(){var z=document.createElement("video");z.volume=0.5;return(z.volume===1)}var e=function(z){this.viewportElem=z;this.videoPlayerWrapper=z.find(".video-player-wrapper");this.loadingOverlay=z.find("#video-loading");this.videoElem=z.find("#h5-player");this.controlElem=z.find("#player-control");this.videoDom=this.videoElem.get(0);this.paused=this.videoDom.paused;this.videoLoaded=false;this.videoPlayStarted=false;this.isDraggingSeekBar=false;this.isDraggingVolumeSlider=false;this.hideSeekBarAfterDrag=false;this.isFullScreenMode=false;this.videoVolumeReadOnly=a();this.encryptedVideoId=this.viewportElem.data("videoId");this.isVideoOwner=this.viewportElem.data("isOwner");this.ownerId=this.viewportElem.data("owner");this.videoDuration=this.viewportElem.data("duration");this.initElements();this.initEventListeners()};e.prototype.initElements=function(){this.playbackButton=this.controlElem.find(".playback-button");this.seekBar=this.controlElem.find(".seek-bar");this.seekBarContainer=this.controlElem.find(".seek-bar-container");this.playedBar=this.seekBar.find(".played-bar");this.bufferedBar=this.seekBar.find(".buffered-bar");this.hoverBar=this.seekBar.find(".hover-bar");this.seekBarTooltip=this.seekBar.find(".time-tooltip");this.volumeControlElem=this.controlElem.find(".volume-control");this.volumeIcon=this.volumeControlElem.find(".volume-icon");this.volumeSlider=this.volumeControlElem.find(".volume-slider");this.volumeSliderThumb=this.volumeSlider.find(".slider-thumb");this.volumeSliderValueBar=this.volumeSlider.find(".slider-track .track-value-bar");this.fullScreenButton=this.controlElem.find(".fullscreen-button");this.progressTime=this.controlElem.find(".progress-time");this.volumeSliderWidth=this.volumeSlider.width();this.unmuteVolume=1;this.mouseDownOnSeekBar=false;this.pausedBeforeMouseDownOnSeekBar=true;if(this.videoVolumeReadOnly){this.volumeControlElem.hide()}this.progressTime.text(this.formatTime(0)+" / "+this.formatTime(this.videoDuration))};e.prototype.initEventListeners=function(){var I=this;var C=j(i.proxy(this.setHideControlsTimeout,this),l);this.viewportElem.on("mouseenter",function(){if(I.videoPlayStarted){if(!I.isDraggingSeekBar&&!I.isDraggingVolumeSlider){I.showControls()}else{I.hideSeekBarAfterDrag=false}}}).on("mouseleave",function(){if(I.videoPlayStarted){if(!I.isDraggingSeekBar&&!I.isDraggingVolumeSlider){I.hideControls()}else{I.hideSeekBarAfterDrag=true}}});i(document).on("webkitfullscreenchange mozfullscreenchange MSFullscreenChange fullscreenchange",function(){if(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement){I.isFullScreenMode=true;I.viewportElem.on("mousemove",C)}else{I.exitFullScreenHandler();I.isFullScreenMode=false;I.viewportElem.off("mousemove",C)}});this.videoPlayerWrapper.on("click",function(){I.playbackHandler()});this.videoElem.on("loadeddata",function(){I.videoLoaded=true}).on("ended",function(){I.clearHideControlsTimeout();I.paused=true;I.setPlaybackButtonState(h.ENDED);I.setControlElemState(v.NON_PLAYING);I.videoPlayStarted=false;I.hideLoading();I.showControls()}).on("pause",function(){I.clearHideControlsTimeout();I.paused=true;I.setPlaybackButtonState(h.PAUSED);I.setControlElemState(v.NON_PLAYING);if(I.isFullScreenMode){I.showControls()}}).on("play",function(){I.paused=false;if(o&&this.webkitEnterFullscreen){this.webkitEnterFullscreen()}I.showControls();I.setPlaybackButtonState(h.PLAYING);I.setControlElemState(v.NON_PLAYING);if(!I.videoPlayStarted){I.videoPlayStarted=true;I.videoElem.removeClass("hidden")}if(I.isFullScreenMode){I.setHideControlsTimeout()}}).on("playing",function(){I.paused=false;I.setPlaybackButtonState(h.PLAYING);I.setControlElemState(v.PLAYING);I.hideLoading();if(I.videoPlayStarted&&w&&(I.videoDom.currentTime>=m)&&(I.safariHackItr!==undefined)){clearInterval(I.safariHackItr);I.safariHackItr=undefined}}).on("waiting",function(){I.showLoading();if(I.videoPlayStarted&&w&&(I.videoDom.currentTime===0)&&(I.safariHackItr===undefined)){I.safariHackItr=setInterval(function(){if(!I.videoDom.paused&&(I.videoDom.currentTime<m)&&(I.videoDom.duration>m)){try{I.videoDom.currentTime=m}catch(K){}}},x)}});if(!this.videoVolumeReadOnly){var E={start:"mousedown",move:"mousemove",end:"mouseup"};if(u()){E={start:"touchstart",move:"touchmove",end:"touchend"}}this.volumeIcon.on("click",function(){if(I.videoDom.volume===0){I.videoDom.volume=I.unmuteVolume;I.volumeControlElem.removeClass("muted")}else{I.unmuteVolume=I.videoDom.volume;I.videoDom.volume=0;I.volumeControlElem.addClass("muted")}var K=(I.videoDom.volume*100)+"%";I.volumeSliderThumb.css("left",K);I.volumeSliderValueBar.css("width",K)});this.volumeSlider.on(E.start,function(){I.mouseDownOnVolumeSlider=true});var B=function(O){var K=i(I.volumeSlider).offset();var M=O.originalEvent.pageX;if(O.originalEvent.touches){M=O.originalEvent.touches[0].pageX}var L=M-K.left;L=Math.max(0,L);L=Math.min(I.volumeSliderWidth,L);I.volumeControlElem.toggleClass("muted",(L===0));I.volumeSliderThumb.css("left",L);I.volumeSliderValueBar.css("width",L);var N=L/I.volumeSliderWidth;I.videoDom.volume=N};var H=function(K){B(K);I.isDraggingVolumeSlider=true};var A=function(){y("");I.isDraggingVolumeSlider=false;i(document).off(E.move,H);i(document).off(E.end,A)};this.volumeSlider.on(E.start,function(){y("none");i(document).on(E.move,H);i(document).on(E.end,A)});this.volumeSlider.on("click",B)}setInterval(function(){var L=I.seekBar.width(),K=I.videoDom.duration,M=I.videoDom.buffered.length,Q=I.videoDom.currentTime;if(M===1){I.bufferedBar.width(I.videoDom.buffered.end(0)/K*L)}else{if(M>1){var P,N;for(var O=0;O<M;O++){P=I.videoDom.buffered.start(O);N=I.videoDom.buffered.end(O);if((Q>=P)&&(Q<=N)){I.bufferedBar.width(N/K*L);break}}}}if(!I.videoLoaded){return}I.progressTime.text(I.formatTime(Q)+" / "+I.formatTime(I.videoDom.duration));I.playedBar.width(Q/K*L)},d);var G="mousedown",F="mousemove",z="mouseup";if(u()){G="touchstart";F="touchmove";z="touchend"}var D=function(P){if((P.type==="mousedown")||(P.type==="touchstart")){I.pausedBeforeMouseDownOnSeekBar=I.paused;I.videoDom.pause();I.mouseDownOnSeekBar=true}var L=i(I.seekBar).offset();var M=P.originalEvent.pageX;if(P.originalEvent.touches){M=P.originalEvent.touches[0].pageX}var O=M-L.left;var K=I.seekBar.width();O=Math.max(0,O);O=Math.min(K,O);I.seekBarTooltip.css("left",O);var N=O/K*I.videoDom.duration;if(N<0){N=0}else{if(N>I.videoDom.duration){N=I.videoDom.duration}}I.seekBarTooltip.text(I.formatTime(N));I.hoverBar.width(O);if((I.mouseDownOnSeekBar)&&(I.seekBar.width()!==0)){I.playedBar.width(O);I.videoDom.currentTime=O/I.seekBar.width()*I.videoDom.duration}};if(!u()){this.seekBarContainer.on("mousemove",function(K){D(K)})}var J=function(K){y("");if(I.hideSeekBarAfterDrag){I.hideControls()}if(!I.pausedBeforeMouseDownOnSeekBar){I.videoDom.play()}I.pausedBeforeMouseDownOnSeekBar=false;I.isDraggingSeekBar=false;I.hideSeekBarAfterDrag=false;I.mouseDownOnSeekBar=false;i(document).off(F,D);i(document).off(z,J)};this.seekBarContainer.on(G,function(K){y("none");I.isDraggingSeekBar=true;I.hideSeekBarAfterDrag=false;D(K);i(document).on(F,D);i(document).on(z,J)});this.seekBarContainer.on("click",D);this.playbackButton.on("click",function(){I.playbackHandler()});this.fullScreenButton.on("click",function(){I.fullScreenHandler()})};e.prototype.playbackHandler=function(){if(this.paused){this.videoDom.play()}else{this.videoDom.pause()}};e.prototype.pause=function(){if(this.videoDom&&!this.paused){this.videoDom.pause()}};e.prototype.isFullScreen=function(){return(document.fullscreenElement&&(document.fullscreenElement!==null))||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement};e.prototype.exitFullScreenHandler=function(){if(document.exitFullScreen){document.exitFullScreen()}else{if(document.msExitFullscreen){document.msExitFullscreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitExitFullscreen){document.webkitExitFullscreen()}}}}};e.prototype.fullScreenHandler=function(){if(o&&this.videoDom.webkitEnterFullscreen){this.videoDom.webkitEnterFullscreen();return}if(this.isFullScreen()){this.exitFullScreenHandler();this.clearHideControlsTimeout()}else{var z=this.viewportElem.get(0);if(z.requestFullscreen){z.requestFullscreen()}else{if(z.msRequestFullscreen){z.msRequestFullscreen()}else{if(z.mozRequestFullScreen){z.mozRequestFullScreen()}else{if(z.webkitRequestFullscreen){z.webkitRequestFullscreen()}}}}}};e.prototype.setHideControlsTimeout=function(){var z=this;this.showControls();if(!this.paused){this.clearHideControlsTimeout();p=setTimeout(function(){z.hideControls();p=null},c)}};e.prototype.clearHideControlsTimeout=function(){if(p){clearTimeout(p);p=null}};e.prototype.formatTime=function(B){if(isNaN(B)){return"00:00"}B=Math.round(B);var z=Math.floor(B/60),A=B%60;if(z<10){z="0"+z}if(A<10){A="0"+A}return z+":"+A};e.prototype.showControls=function(){this.controlElem.not(":visible").fadeIn(f)};e.prototype.hideControls=function(){this.controlElem.hide()};e.prototype.showLoading=function(A){var z=this;if(typeof A==="string"){this.loadingOverlay.find(".video-loading-message").text(A)}this.loadingOverlay.show();if(!k){k=setTimeout(function(){z.loadingOverlay.find(".video-loading-message").html(r)},b)}};e.prototype.hideLoading=function(){if(k){clearTimeout(k);k=null}this.loadingOverlay.find(".video-loading-message").empty();this.loadingOverlay.hide()};e.prototype.setPlaybackButtonState=function(z){this.playbackButton.removeClass(h.PAUSED);this.playbackButton.removeClass(h.PLAYING);this.playbackButton.removeClass(h.ENDED);this.playbackButton.addClass(z)};e.prototype.setControlElemState=function(z){this.controlElem.removeClass(v.PLAYING);this.controlElem.removeClass(v.NON_PLAYING);this.controlElem.addClass(z)};e.prototype.reset=function(){if(!this.paused){this.videoDom.pause()}this.videoDom.currentTime=0;this.videoPlayStarted=false;this.hideLoading();this.controlElem.show();this.setPlaybackButtonState(h.PAUSED);this.setControlElemState(v.NON_PLAYING);this.videoElem.addClass("hidden")};var g=new e(i(".video-player-viewport"));i(".video-player-viewport").data("videoControl",g)})(jQuery,window);
