(function(g){var j=144;var n=100;var f=null;var e=function(o){var p=this;this.allowExternalReviewers=false;this.$el=o;this.invite_candidates=[];this.$el.on("loaded",function(){var q=p.$el.find('input[name="user_token"]'),r=p.$el.find('[name="role"]');p.allowExternalReviewers=q.data("allowExternalReviewers");g.getJSON("/ajax/getCollaboratorCandidates",function(s){if(s.suc){p.invite_candidates=s.candidates}if(q.data("bs.tokenfield")){q.tokenfield("destroy")}q.val("").on("tokenfield:preparetoken",function(u){var v=p.invite_candidates,t;if(!p.isEmail(u.token.value)){for(t in v){if(u.token.value==v[t].label){u.token.value=v[t].value;u.token.label=v[t].label;return}}}else{for(t in v){if(u.token.value==v[t].value){u.token.label=v[t].label;return}}}}).on("tokenfield:createtoken",function(v){if(!p.allowExternalReviewers||(r.val()=="producer")){var w=p.invite_candidates,u=false,t;for(t in w){if(v.token.value==w[t].value){u=true;break}}if(!u){g(v.relatedTarget).addClass("invalid")}else{g(v.relatedTarget).addClass("valid")}}else{if(!p.isEmail(v.token.value)){g(v.relatedTarget).addClass("invalid")}else{g(v.relatedTarget).addClass("valid")}}g(".token-input").attr("placeholder","")}).on("tokenfield:startedit",function(u){var t=g.Event("change");t.initiator="tokenfield";g(u.target).trigger(t)}).on("tokenfield:removetoken",function(t){g(t.target).trigger("change");if(g(this).tokenfield("getTokens").length===0){g(".token-input").attr("placeholder","Enter email(s)")}}).on("change",function(t){g(t.target).parents(".form-row").removeClass("error");if(g(t.target).val()){if(g(t.target).tokenfield("getTokens",".invalid").length===0){g(t.target).parents("form").find('[type="submit"]').prop("disabled",false)}else{g(t.target).parents("form").find('[type="submit"]').prop("disabled",true);g(t.target).parents(".form-row").addClass("error")}}else{g(t.target).parents("form").find('[type="submit"]').prop("disabled",true)}}).tokenfield({createTokensOnBlur:true,beautify:false,autocomplete:{source:function(v,u){var t=[];g.each(p.invite_candidates,function(w,x){if((x.label.toLowerCase().search(v.term.toLowerCase())>=0)||(x.value.toLowerCase().search(v.term.toLowerCase())>=0)){t.push(x)}});u(t)},delay:100},showAutocompleteOnFocus:true});r.on("change",function(){q.tokenfield("setTokens",q.tokenfield("getTokens"))})})});this.$el.on("submit",".js-invite-collaborators-submit",function(r){r.preventDefault();var s=p.invite_candidates,u=[],t=g(this);g.each(t.find('input[name="user_token"]').tokenfield("getTokens",".valid"),function(v,y){var x=false;for(var w in s){if(y.value==s[w].value){u.push(s[w].b_value);x=true;break}}if(!x){u.push(y.value)}});t.find('input[name="raw_user_token"]').val(u.join(","));t.find('[type="submit"]').text(GT.gettext("Sending")).prop("disabled",true);var q=t.serialize();q+="&ct="+encodeURIComponent(f);p.inviteCollaborators(q).done(function(){t.find('[type="submit"]').text(GT.gettext("Send")).find('input[name="raw_user_token"]').val("").end().find('[name="message"]').val("").end().find('input[name="user_token"]').val("").tokenfield("setTokens",true,false)})}).on("click",".js-show-message-box",function(q){q.preventDefault();g(this).addClass("hidden").next("textarea").removeClass("hidden")})};e.prototype=g.extend({},ModalBase.prototype,{isEmail:function(p){var o=/[a-z0-9!#$%&'*+/=?^_{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/i;return o.test(p)},inviteCollaborators:function(p){var o=this,q=g(".js-invite-collaborators-submit");return g.post("/ajax/inviteCollaborators",p,function(r){o.$el.modal("hide");if(r.error){showNotice(r.error,true);return}showNotice(r.msg);g.each(o.$el.find('input[name="user_token"]').tokenfield("getTokens",".valid"),function(t,x){var w=AMPLITUDE_EVENT_PROPERTIES.NO,v=o.invite_candidates.length,s;for(var u=0;u<v;u++){if(o.invite_candidates[u].value===x.value){w=AMPLITUDE_EVENT_PROPERTIES.YES;break}}s={role:q.find('select[name="role"]').val(),goteam_member:w,status:q.find('input[name="movie-privacy"]').val(),video_id:q.find('input[name="movieId"]').val(),owner:q.data("is-owner"),owner_id:q.data("owner")};amplitudeTrackEvent(AMPLITUDE_EVENT.INVITE_COLLABORATOR,s)});g(document).trigger("collaborator-change")},"json")}});var l=function(o){var p=this;this.$el=o;this.processing=false;this.$el.on("submit",".js-update-collaborators",function(s){var q=g(this);s.preventDefault();var r=q.serialize();r+="&ct="+encodeURIComponent(f);p.save(r)}).on("click",".js-remove-collaborator",function(u){u.preventDefault();var r=g(this).tooltip("destroy"),t=r.closest(".form-group"),q=t.find("select"),s=g("<input>",{type:"hidden",name:q.attr("name"),value:"delete"});q.prop("disabled",true).after(s);t.hide();p.toggleChanged(true)}).on("click",".js-cancel-collaborator-changes",function(q){q.preventDefault();p.cancelChanges()}).on("change","select",function(){p.toggleChanged(true)})};l.prototype=g.extend({},ModalBase.prototype,{save:function(p){var o=this;if(this.processing){return}this.processing=true;g.post("/ajax/updateCollaborators",p,function(q){o.processing=false;if(q.error){return}g(document).trigger("collaborator-change");o.toggleChanged(false);o.$el.modal("hide");g("#invite-collaborator-modal").modal("hide")},"json")},toggleChanged:function(o){this.$el.toggleClass("has-changes",o)},cancelChanges:function(){this.toggleChanged(false);this.$el.find("select[disabled]").each(function(){var o=g(this),p=o.next("input"),q=o.closest(".form-group");o.prop("disabled",false);p.remove();q.show()});this.$el.find("[data-default-value]").each(function(){var o=g(this);o.val(o.data("defaultValue"))})}});var d=function(o){this.$el=o};d.prototype=g.extend({},ModalBase.prototype,{});var i=function(o){var p=this;this.$el=o;this.$el.on("submit","#movie-license-form",function(q){q.preventDefault();if(p.validateAddressForm()){p.setLicense(g(this).serialize())}}).on("click",'[data-action="buttonControl"]',function(r){var q=g(this);r.preventDefault();p.buttonControl(q.data("hide"),q.data("show"))}).on("change",'[name="cbo_country"]',function(){p.resetState()}).on("change",'[name="license_type"]',function(){p.toggleCompanyInput()}).on("loaded",function(){p.resetState()})};i.sCountryWithoutZipCodeString="Afghanistan|Angola|Antigua and Barbuda|Aruba|Bahamas|Belize|Benin|Bhutan|Botswana|Burkina Faso|Burundi|Cameroon|Central African Republic|Comoros|Congo|Congo, The Democratic Republic of|Cook Islands|CÃ´te d'Ivoire|Djibouti|Dominica|Equatorial Guinea|Eritrea|Fiji|Gambia|Gibraltar|Grenada|Guinea|Guyana|Hong Kong|Iceland|Kiribati|Korea, Democratic People's Republic of|Macao|Malawi|Mali|Mauritania|Mauritius|Montserrat|Namibia|Nauru|Netherlands Antilles|Niue|Panama|Qatar|Rwanda|Saint Kitts and Nevis|Saint Lucia|Saint Vincent and The Grenadines|Seychelles|Sierra Leone|Solomon Islands|Somalia|Suriname|Tanzania, United Republic of|Tokelau|Tonga|Trinidad and Tobago|Tuvalu|Uganda|United Arab Emirates|Vanuatu|Yemen|Zimbabwe";i.aCountryWithoutZipCode=i.sCountryWithoutZipCodeString.split("|");i.sCanadaStatesString="Alberta|British Columbia|Manitoba|New Brunswick|Newfoundland|Northwest Territories|Nova Scotia|Nunavut|Ontario|Prince Edward Island|Quebec|Saskatchewan|Yukon Territory";i.aCanadaStates=i.sCanadaStatesString.split("|");i.sCanadaStatesCodeString="AB|BC|MB|NB|NL|NT|NS|NU|ON|PE|QC|SK|YT";i.aCanadaStatesCode=i.sCanadaStatesCodeString.split("|");i.sUSAStatesString="Alabama|Alaska|Arizona|Arkansas|California|Colorado|Connecticut|Delaware|District of Columbia|Florida|Georgia|Hawaii|Idaho|Illinois|Indiana|Iowa|Kansas|Kentucky|Louisiana|Maine|Maryland|Massachusetts|Michigan|Minnesota|Mississippi|Missouri|Montana|Nebraska|Nevada|New Hampshire|New Jersey|New Mexico|New York|North Carolina|North Dakota|Ohio|Oklahoma|Oregon|Pennsylvania|Rhode Island|South Carolina|South Dakota|Tennessee|Texas|Utah|Vermont|Virginia|Washington|West Virginia|Wisconsin|Wyoming|Armed Forces Americas|Armed Forces|Armed Forces Pacific";i.aUSAStates=i.sUSAStatesString.split("|");i.sUSAStatesCodeString="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY|AA|AE|AP";i.aUSAStatesCode=i.sUSAStatesCodeString.split("|");i.prototype=g.extend({},ModalBase.prototype,{setLicense:function(p){var o=this;this.loading();g.post("/ajax/manageMovieOwner/set",p,function(q){o.loading();if(q.error){o.alert(q.error,"error")}else{if(o.$el.find("#preview_license").length>0){o.previewLicense();o.buttonControl("#transfer_rights_form","#preview_license")}else{o.buttonControl("#transfer_rights_form","#ending")}}},"json")},buttonControl:function(p,o){this.$el.find(p).hide();this.$el.find(o).show();if(o=="#ending"||o=="#failure"){this.$el.find(".movie_license_header").hide()}else{this.$el.find(".movie_license_header").show()}},resetState:function(){var p=this;var q=this.$el.find("#cboCountry").val();var o=this.$el.find("#user_state").val();if(q=="US"){this.$el.find("#input-state").hide();this.$el.find("#input-state").val("");this.$el.find("#cboState").show();p.updateOptions(this.$el.find("#cboState"),i.aUSAStates,i.aUSAStatesCode);this.$el.find("#cboState").val(o)}else{if(q=="CA"){this.$el.find("#input-state").hide();this.$el.find("#input-state").val("");this.$el.find("#cboState").show();p.updateOptions(this.$el.find("#cboState"),i.aCanadaStates,i.aCanadaStatesCode);this.$el.find("#cboState").val(o)}else{this.$el.find("#input-state").show();this.$el.find("#cboState").hide()}}p.updateZip()},toggleCompanyInput:function(){var o=this.$el.find('[name="license_type"]:checked').val();if(o=="individual"){this.$el.find("#company_input").hide();this.$el.find('[name="company_name"]').val("")}else{if(o=="company"){this.$el.find("#company_input").show()}}},updateOptions:function(q,p,o){var r;if(q.prop){r=q.prop("options")}else{r=q.attr("options")}g("option",q).remove();g.each(p,function(s,t){r[r.length]=new Option(t,o[s])})},updateZip:function(){if(this.containsNoZip(this.$el.find("#cboCountry :selected").text())){this.$el.find("#fld_cczipcode").hide();this.$el.find("#cczipcode").val("00000")}else{if(this.$el.find("#cczipcode").val()=="00000"){this.$el.find("#cczipcode").val("")}this.$el.find("#fld_cczipcode").show()}},containsNoZip:function(p){for(var o=0;o<i.aCountryWithoutZipCode.length;o++){if(i.aCountryWithoutZipCode[o]===p){return true}}return false},validateAddressForm:function(){this.$el.find(".help-block").remove();this.$el.find(".form-group").removeClass("has-error");var u=[];var o=this.$el.find('[name="company_name"]').val();var t=this.$el.find('[name="contact_person"]').val();var q=this.$el.find('[name="license_type"]:checked').val();var p=this.$el.find('[name="email"]').val();if(q=="company"){if(o===""){u.push({id:"#fld_company_name",msg:GT.gettext("Please input your company name")})}}if(t===""){u.push({id:"#fld_contact_person",msg:GT.gettext("Please input the name of your contact person")})}if(p!==""){if(!emailUtil.isValidFormat(p)){u.push({id:"#fld_email",msg:GT.gettext("Invalid email")})}}var s;for(var r=0;r<u.length;r++){s=g(u[r].id).closest(".form-group").addClass("has-error").find(".help");if(u[r].msg.length){s.append(g('<div class="help-block" />').text(u[r].msg))}}if(u.length>0){return false}else{return true}},previewLicense:function(){var p="",o=this.$el.find('[name="license_type"]:checked').val();if(o==="company"){p=this.$el.find('[name="company_name"]').val()}else{p=this.$el.find('[name="contact_person"]').val()}this.$el.find(".b_contact").text(p)},paymentConfirmed:function(o){this.buttonControl("#payment_info","#payment_confirmation");this.$el.find("#payment_confirmation").empty().html(o.html)}});var m={};m.BaseClass=function(o,q){var p=this;this.successExportMessage=GT.gettext("Your video has been sent to the conversion queue and will be uploaded shortly.");this.errorExportMessage=GT.gettext("Video export request failed.");this.processing=false;this.$el=o;this.videoId=q;this.$el.on("click","[data-video-export]",function(r){r.preventDefault();r.stopImmediatePropagation();p.triggerVideoExport(g(this))}).on("click",".message-button-holder > button",function(r){r.preventDefault();r.stopImmediatePropagation();p.$el.find(".toggle-content").removeClass("message toggle-on")}).on("documentClicked",function(t,u){var s=g(u.target),r=p.$el.find(".toggle-content");if(r.hasClass("toggle-on")&&!s.closest(p.$el).length){r.removeClass("toggle-on");p._destroyTooltips()}}).on("click",'[data-action="select-resolution"]',function(r){r.preventDefault();r.stopImmediatePropagation();p.$el.find(".resolution-option").hide();g(this).next("ul").show()})};m.BaseClass.prototype.showExportOptions=function(r){var p=this,o=this.$el.find(".toggle-content"),q=this.$el.find(".spin");if(this.processing){return}this._destroyTooltips();o.empty();if(!o.hasClass("toggle-on")){var s="/"+["ajax","getVideoExportOverlay",this.videoId,this.getServiceName(),"box"].join("/");this.processing=true;q.show();g.get(s,function(t){q.hide();o.addClass("toggle-on");p.processing=false;var u=g(t).find("#anonymous_user");if(u&&(u.length>0)){window.location=u.attr("href")}o.html(t);if(r){p.$el.find(".toggle-content .row-in-3, .toggle-content .row-in-4").hide().end().find(".toggle-content .reject-feedback").show()}p.$el.find(".convert-video-icon").attr("title",GT.gettext("Convert video")).tooltip({placement:"right"});p.$el.find(".download-video-icon").attr("title",GT.gettext("Download your video")).tooltip({placement:"right"});p.$el.find(".quick-upload-icon").attr("title",GT.gettext("Quick export")).tooltip({placement:"right"})}).fail(function(){p.processing=false})}};m.BaseClass.prototype.triggerVideoExport=function(o){var p=this,q=o.attr("href");if(this.processing){return}this.processing=true;o.find(".icon").children().tooltip("destroy").end().html('<span class="processing"></span>');g.post(q,{ct:f},function(r){p.processing=false;if(r.error){p.videoExportRequestCompleted(r.error);return}p.videoExportRequestCompleted(p.successExportMessage);if(o.hasClass("js-trigger-transfer-rights-survey")){g("#transfer-rights-survey-modal").modal()}},"json").fail(function(){p.processing=false;p.videoExportRequestCompleted(p.errorExportMessage)})};m.BaseClass.prototype.videoExportRequestCompleted=function(o){this._destroyTooltips();this.$el.find(".message").text(o);this.$el.find(".toggle-content .row-in-3, .toggle-content .row-in-4").hide().end().find(".toggle-content .ok-feedback").show()};m.BaseClass.prototype.start=function(){this.showExportOptions()};m.BaseClass.prototype._destroyTooltips=function(){this.$el.find(".convert-video-icon, .download-video-icon, .quick-upload-icon").tooltip("destroy")};m.BaseConnectClass=function(o,q){m.BaseClass.call(this,o,q);var p=this;this.connected=this.$el.data("connected");this.$el.on("click",'[data-action="video-export-disconnect"]',function(r){r.preventDefault();r.stopImmediatePropagation();p.disconnectFrom3rdParty()}).on("connectSuccess",function(s,r){p.videoExportConnected(r)}).on("connectError",function(s,r){p.videoConnectError(r)})};m.BaseConnectClass.prototype=g.extend({},m.BaseClass.prototype);m.BaseConnectClass.prototype.start=function(){if(this.connected){this.showExportOptions()}else{this.connectTo3rdParty()}};m.BaseConnectClass.prototype.open3rdPartyConnectWindow=function(o){window.open(o,"_go_video_export","toolbar=no,status=no,height=650,width=960")};m.BaseConnectClass.prototype.connectTo3rdParty=function(){this.$connectModal=ModalBase.ensure("video-connect-"+this.getServiceName());var o=this.$connectModal.data("videoConnect");if(!o){o=new c(this.$connectModal);this.$connectModal.data("videoConnect",o)}o.load(this.getConnectUrl())};m.BaseConnectClass.prototype.disconnectFrom3rdParty=function(){var p=this;var o=this.getVideoResetUrl();g.get(o,function(q){p.videoExportDisconnected()})};m.BaseConnectClass.prototype.videoExportConnected=function(o){if(this.$connectModal){this.$connectModal.modal("hide")}this.connected=true;this.$el.data("connected",true).addClass("connected");this.showExportOptions();amplitudeTrackEvent(AMPLITUDE_EVENT.CONNECT_TO_3RD_PARTY,{service:this.getServiceName(),video_id:this.videoId,channel_url:null})};m.BaseConnectClass.prototype.videoExportDisconnected=function(){this.connected=false;this.$el.data("connected",false).removeClass("connected").find(".toggle-content .row-in-3, .toggle-content .row-in-4").hide().end().find(".toggle-content .disconnect-feedback").show();amplitudeTrackEvent(AMPLITUDE_EVENT.DISCONNECT_FROM_3RD_PARTY,{service:this.getServiceName()})};m.BaseConnectClass.prototype.videoConnectError=function(o){this.showExportOptions(true)};m.BaseConnectClass.prototype.getConnectUrl=function(){return"/"+["ajax","getVideoExportOverlay",this.videoId,this.getServiceName()].join("/")};m.BaseConnectClass.prototype.getVideoResetUrl=function(){throw new Error("Method not implemented")};m.Download=function(o,p){m.BaseClass.call(this,o,p);this.successExportMessage=GT.gettext("Your video has been sent to the conversion queue and we'll email you when it's ready for download.")};m.Download.prototype=g.extend({},m.BaseClass.prototype,{getServiceName:function(){if(isUsingLegacyPlayer()){return"download"}else{return"h5"}}});m.Presentation=function(o,p){m.BaseClass.call(this,o,p);this.successExportMessage=GT.gettext("Your video has been sent to the conversion queue and we'll email you when it's ready for download.")};m.Presentation.prototype=g.extend({},m.BaseClass.prototype,{getServiceName:function(){if(isUsingLegacyPlayer()){return"presentation"}else{return"h5presentation"}}});m.Gif=function(o,p){m.BaseClass.call(this,o,p);this.successExportMessage=GT.gettext("Your video has been sent to the conversion queue and we'll email you when it's ready for download.")};m.Gif.prototype=g.extend({},m.BaseClass.prototype,{getServiceName:function(){if(isUsingLegacyPlayer()){return"gif"}else{return"h5gif"}}});m.Youtube=function(o,q){m.BaseConnectClass.call(this,o,q);var p=this;this.$el.on("exportSuccess",function(s,r){p.videoExportRequestCompleted(p.successExportMessage)}).on("exportError",function(s,r){if(r.duplicated){p.videoExportRequestCompleted(p.successExportMessage)}else{p.videoExportRequestCompleted(r.error)}})};m.Youtube.prototype=g.extend({},m.BaseConnectClass.prototype,{triggerVideoExport:function(o){var p=o.attr("href");p=p+"&ct="+encodeURIComponent(f);this.open3rdPartyConnectWindow(p)},getServiceName:function(){if(isUsingLegacyPlayer()){return"youtube"}else{return"h5youtube"}}});m.Wistia=function(o,p){m.BaseConnectClass.call(this,o,p)};m.Wistia.prototype=g.extend({},m.BaseConnectClass.prototype,{getVideoResetUrl:function(){return"/wistiaReset"},getServiceName:function(){if(isUsingLegacyPlayer()){return"wistia"}else{return"h5wistia"}}});m.Vimeo=function(o,p){m.BaseConnectClass.call(this,o,p)};m.Vimeo.prototype=g.extend({},m.BaseConnectClass.prototype,{connectTo3rdParty:function(){this.open3rdPartyConnectWindow("/vimeoConnect")},getVideoResetUrl:function(){return"/vimeoReset"},getServiceName:function(){if(isUsingLegacyPlayer()){return"vimeo"}else{return"h5vimeo"}}});m.Vzaar=function(o,p){m.BaseConnectClass.call(this,o,p)};m.Vzaar.prototype=g.extend({},m.BaseConnectClass.prototype,{getVideoResetUrl:function(){return"/vzaarReset"},getServiceName:function(){if(isUsingLegacyPlayer()){return"vzaar"}else{return"h5vzaar"}}});m.Viewbix=function(o,p){m.BaseConnectClass.call(this,o,p)};m.Viewbix.prototype=g.extend({},m.BaseConnectClass.prototype,{getConnectUrl:function(){return"/ajax/getViewbixExportOverlay/"+this.videoId},getServiceName:function(){if(isUsingLegacyPlayer()){return"viewbix"}else{return"h5viewbix"}}});m.Lectora=function(o,p){m.BaseConnectClass.call(this,o,p)};m.Lectora.prototype=g.extend({},m.BaseConnectClass.prototype,{getConnectUrl:function(){return"/ajax/getLectoraExportOverlay/"+this.videoId},getServiceName:function(){if(isUsingLegacyPlayer()){return"lectora"}else{return"h5lectora"}},getVideoResetUrl:function(){return"/lectoraReset"}});m.WeVideo=function(o,p){m.BaseConnectClass.call(this,o,p)};m.WeVideo.prototype=g.extend({},m.BaseConnectClass.prototype,{getVideoResetUrl:function(){return"/ajax/wevideo/logout"},getServiceName:function(){if(isUsingLegacyPlayer()){return"wevideo"}else{return"h5wevideo"}}});m.Vidyard=function(o,p){m.BaseConnectClass.call(this,o,p)};m.Vidyard.prototype=g.extend({},m.BaseConnectClass.prototype,{disconnectFrom3rdParty:function(){var p=this;var o=this.getVideoResetUrl();g.post(o,{"delete":1},function(q){p.videoExportDisconnected()},"json")},getVideoResetUrl:function(){return"/ajax/vidyardUpdateToken"},getServiceName:function(){if(isUsingLegacyPlayer()){return"vidyard"}else{return"h5vidyard"}}});var c=function(o,q){var p=this;this.$el=o;this.options=q;this.$el.on("click.video.goanimate",'[data-action="wistia-connect"]',function(s){var r=g(this);s.preventDefault();p.popWindow(r.data("url"))}).on("change.video.goanimate keyup.video.goanimate",'[data-action="wevideo-auth"] input[name="email"]',function(r){if(!p.$el.find(".wevideo-export-authorize-action span:visible").hasClass("wevideo-export-authorize-button")){p.$el.find(".wevideo-export-authorize-action").find("span").hide().end().find(".wevideo-export-authorize-button").show()}}).on("submit.video.goanimate",'[data-action="wevideo-auth"]',function(s){var r=g(this);s.preventDefault();r.find(".wevideo-export-authorize-action").find("span").hide().end().find(".wevideo-export-authorize-loading").show();g.ajax({type:"POST",url:r.attr("action"),data:r.serialize(),success:function(t){if(t.suc){r.parents(".modal-body").find(".pick-resolution .wevideo_email").text(r.find('input[name="email"]').val());r.find(".wevideo-export-authorize-action").find("span").hide().end().find(".wevideo-export-authorize-message-success").show();p.$el.find('[data-action="wevideo-proceed-export"]').prop("disabled",false)}else{r.find(".wevideo-export-authorize-action").find("span").hide().end().find(".wevideo-export-authorize-message-fail").show()}},error:function(){p.alert(GT.gettext("Error contacting the server"),"error")},dataType:"json"})}).on("click.video.goanimate",'[data-action="wevideo-proceed-export"]',function(r){r.preventDefault();g("#wevideo-export").trigger("connectSuccess")});this.$el.on("click",'[data-action="vzaar-connect"]',function(s){var r=g(this);s.preventDefault();p.$el.find(".modal-content").addClass("authorizing");p.popWindow(r.data("url"))}).on("click",'[data-action="vzaar-authorize-cancel"]',function(r){r.preventDefault();p.$el.find(".modal-content").removeClass("authorizing")}).on("vzaarConnectError",function(s,r){p.alert(r.error,"error")});this.$el.on("click",'[data-action="vidyard-connect"]',function(t){var s=g(this),r=p.$el.find("#vidyard_token_in").val();t.preventDefault();p.$el.find(".modal-footer button.connect").addClass("disabled");g.ajax({type:"POST",url:s.data("remote"),data:{token:r},success:function(u){p.$el.find(".modal-footer button.connect").removeClass("disabled");if(u.error){p.alert(u.error,"error");return}else{if(u.message){p.alert(u.message)}}g("#vidyard-export").trigger("connectSuccess",[u])},error:function(){p.alert(GT.gettext("Error contacting the server"),"error");p.$el.find(".modal-footer button.connect").removeClass("disabled")}})}).on("click",".js-show-vidyard-tutorial",function(t){var u="https://fast.wistia.net/embed/iframe/zo6nqx67j4?autoPlay=1&endVideoBehavior=reset",r=g("#video-modal-wistia"),s=g('<iframe class="embed-responsive-item" allowfullscreen></iframe>').attr("src",u);t.preventDefault();r.detach().appendTo("body").modal({keyboard:true,backdrop:true}).on("hidden.bs.modal",function(){r.find(".embed-player").empty()});r.find(".embed-player").empty().append(s)})};c.prototype=g.extend({},ModalBase.prototype,{popWindow:function(o){window.open(o,"_go_video_export","toolbar=no,status=no,height=650,width=960")},wistiaConnectSuccess:function(o){this.$el.find(".modal-body").addClass("authorized").find(".wistia-account-name").text(o.account_name)}});window.videoExportError=function(o){g("#youtube-export, #video-export").trigger("exportError",[o])};window.videoExportStarted=function(o){g("#youtube-export, #video-export").trigger("exportSuccess",[o])};window.wistiaConnectError=function(o){g("#wistia-export").trigger("connectError",[o])};window.wistiaConnectSuccess=function(o){g("#wistia-export").trigger("connectSuccess",[o])};window.vzaarConnectError=function(o){g("#vzaar-export").trigger("connectError",[o])};window.vzaarConnectSuccess=function(o){g("#vzaar-export").trigger("connectSuccess",[o])};window.vimeoConnectSuccess=function(o){g("#vimeo-export").trigger("connectSuccess",[o])};window.vimeoConnectError=function(o){g("#vimeo-export").trigger("connectError",[o])};window.lectoraConnectSuccess=function(o){g("#lectora-export").trigger("connectSuccess",[o])};window.lectoraConnectError=function(o){g("#lectora-export").trigger("connectError",[o])};var b=function(o){this.$el=o};b.prototype=g.extend({},ModalBase.prototype);var k=function(o){this.encryptedMovieId=o;this.slideAnimationPlaying=false;this.initElements();this.initEventListeners();if(this.collaboratorsElem.length>0){this.updateCollaborators()}this.worknoteModule=null;this.isEditingVideoInfo=false;this._lastestRevision=null;this._activeRevision=null};k.prototype.isFullScreen=function(){return(document.fullscreenElement&&(document.fullscreenElement!==null))||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement};k.prototype.enableSticky=function(){g(".video-player-meta > .video-title").html(g(".video-info-content .title").html());g(".video-player-meta > .video-creator").html(g(".video-info-content .creator").html());g(".video-content").height(g(".video-content").height()).addClass("sticky");this.stickyPlayerEnabled=true};k.prototype.disableSticky=function(){g(".video-content").removeClass("sticky").css("height","auto");this.stickyPlayerEnabled=false};k.prototype.initElements=function(){var o=this;this.videoPageElem=g("#video-page");this.settingsSidebarElem=g("#video-page .sidebar");this.settingPanelsElem=this.settingsSidebarElem.find(".setting-panels");this.mainSettingPanelElem=this.settingPanelsElem.find(".main-panel");this.subSettingPanelElem=this.settingPanelsElem.find(".sub-panel");this.videoCopyingItemElem=this.mainSettingPanelElem.find(".item-copy");this.logoSettingItemElem=this.mainSettingPanelElem.find(".item-logo");this.historySettingItemElem=this.settingsSidebarElem.find("[data-action='video-revision']");this.notesSettingItemElem=this.mainSettingPanelElem.find(".item-notes");this.adminItemElem=this.mainSettingPanelElem.find(".item-admin");this.logoSettingPanelElem=this.subSettingPanelElem.find(".logo-panel");this.defaultLogoListElem=this.logoSettingPanelElem.find(".default-logo-list-container .logo-list");this.logoListContainerElem=this.logoSettingPanelElem.find(".logo-list-container");this.historySettingPanelElem=this.subSettingPanelElem.find(".history-panel");this.historyListContainerElem=this.historySettingPanelElem.find(".list-container");this.notesSettingPanelElem=this.subSettingPanelElem.find(".notes-panel");this.notesListContainerElem=this.notesSettingPanelElem.find(".list-container");this.adminPanelElem=this.subSettingPanelElem.find(".admin-panel");this.adminContainerElem=this.adminPanelElem.find(".list-container");this.panelTitleElem=this.subSettingPanelElem.find(".panel-title");this.videoDeletingItemElem=this.mainSettingPanelElem.find(".item-delete");this.videoInfoEditingButtonElem=this.videoPageElem.find('button[data-action="edit-video-info"]');this.collaboratorsElem=this.videoPageElem.find(".collaborators");this.stickyPlayerEnabled=false;this.stickyBeforeFullscreen=false;g("#edit-video-button").attr("title",GT.gettext("Edit Video")).tooltip();g(".toggle-sidebar").attr("title",GT.gettext("Show Settings Menu")).tooltip();g(".toggle-notes").tooltip();g(".video-top").waypoint({handler:function(p){if(!o.isFullScreen()){if(p==="down"){o.enableSticky()}else{if(p==="up"){o.disableSticky()}}}},offset:j});g(document).on("webkitfullscreenchange mozfullscreenchange MSFullscreenChange fullscreenchange",function(){if(o.isFullScreen()){g(".video-top").waypoint("disable");if(o.stickyPlayerEnabled){o.disableSticky();o.stickyBeforeFullscreen=true}}else{g(".video-top").waypoint("enable");if(o.stickyBeforeFullscreen){o.enableSticky()}o.stickyBeforeFullscreen=false}})};k.prototype.initEventListeners=function(){var p=this;g(document).on("playerApiReady",function(){p.playerApi=flashPlayerApi(g("#flash-player"));p.playerApi.bindPlayerEvents().reset()});this.videoPageElem.on("click",".toggle-sidebar",function(){var r=g(this);r.toggleClass("active");if(r.hasClass("active")){r.attr("data-original-title",GT.gettext("Close Settings Menu"))}else{r.attr("data-original-title",GT.gettext("Show Settings Menu"))}r.tooltip("hide");if(r.hasClass("active")){if(p.notesSettingPanelElem.is(":visible")){p.notesSettingPanelElem.hide();p.slideSettingPanel(false)}p.videoPageElem.addClass("sidebar-on").find(".js-toggle-notes").removeClass("active")}else{p.videoPageElem.removeClass("sidebar-on");p.panelTitleElem.trigger("click")}if(p.stickyPlayerDisplay&&p.videoPageElem.hasClass("sidebar-on")){g("body").animate({scrollTop:0})}setTimeout(function(){g.waypoints("refresh")},n)}).on("click",".js-toggle-notes",function(){var r=g(this);r.toggleClass("active");r.tooltip("hide");if(r.hasClass("active")){o();p.videoPageElem.find(".toggle-sidebar").removeClass("active").attr("data-original-title",GT.gettext("Show Settings Menu"))}else{p.videoPageElem.removeClass("sidebar-on");p.notesSettingPanelElem.hide();p.slideSettingPanel(false)}if(p.stickyPlayerEnabled&&p.videoPageElem.hasClass("sidebar-on")){g("body").animate({scrollTop:0})}setTimeout(function(){g.waypoints("refresh")},n)}).on("click",'[data-action="edit-video-info"]',function(r){if(p.isEditingVideoInfo){return}if(isUsingLegacyPlayer()){flashPlayerApi(g("#flash-player")).pause()}else{var s=g(".video-player-viewport").data("h5VideoControl");if(s){s.isEditingVideoInfo=true;s.pause();s.controlElem.hide()}}p.videoPageElem.find(".video-info").addClass("editing").show();p.isEditingVideoInfo=true;r.stopImmediatePropagation();var t=function(v){var u=g(".video-info");if(!u.is(v.target)&&(u.has(v.target).length===0)){p.saveVideoInfo();g(document).off("click",t)}};g(document).on("click",t)}).on("click",'[data-action="video-edit"]',function(u){var t=g(this),r=ModalBase.ensure("video-edit"),s=r.data("videoEdit");if(!s){r.data("videoEdit",s=new b(r))}u.preventDefault();s.load(t.data("remote"))}).on("click",".set-privacy",function(s){var r=g(this);if(r.parent().hasClass("disabled")){s.stopImmediatePropagation();return}p.setPrivacy(r.data("privacy"))}).on("click",".url-sharing",function(r){r.preventDefault();r.stopImmediatePropagation();g.post("/ajax/updateMovieSettings",{sharing:g(this).hasClass("on")?"1":"0",enc_mid:p.encryptedMovieId,ct:g('input[name="ct"]').val()},function(s){if(s.error){showNotice(s.error,true);return}showNotice(GT.gettext("Sharing option changed"));p.toggleSharingUrlDisplay()},"json")});function q(){p.videoPageElem.find(".toggle-sidebar").not(".active").click();if(p.historySettingPanelElem.is(":hidden")){p.historySettingItemElem.click()}}function o(){p.videoPageElem.addClass("sidebar-on");if(p.notesSettingPanelElem.is(":hidden")){p.notesSettingItemElem.click()}}g("#autosave-overlay .history-toggle").click(q);g(document).on("click",function(r){g(".export-option").trigger("documentClicked",r)}).on("click",".js-show-revision-history",q).on("click",'[data-action="video-license"]',function(u){var t=g(this),r=ModalBase.ensure("video-license"),s=r.data("videoLicense");if(!s){r.data("videoLicense",s=new i(r));window.themeassetprovider_payment_confirm=function(v){s.paymentConfirmed(v)};r.scroll(function(){r.modal("handleUpdate")})}u.preventDefault();s.load(t.data("remote"));amplitudeTrackEvent(AMPLITUDE_EVENT.CTA_TRANSFER_RIGHTS,{video_id:p.encryptedMovieId,status:t.data("status")})}).on("click",'[data-action="video-embed"]',function(u){var t=g(this),r=ModalBase.ensure("video-embed"),s=r.data("videoEmbed");if(!s){r.data("videoEmbed",s=new d(r))}u.preventDefault();s.load(t.data("remote"))}).on("click",'[data-action="video-export"]',function(){var s=g(this),r=s.data("type"),t=s.data("videoExport");if(!t){s.data("videoExport",t=new m[r](s,p.encryptedMovieId))}t.start()}).on("submit","#movie-setting-form",function(r){r.preventDefault();p.saveVideoInfo()}).on("click",".sharing-button",function(){var r=g(this).data("shareTarget");amplitudeTrackShare(r,AMPLITUDE_EVENT_PROPERTIES.VIDEO_RESOLUTION_400,flashVar.duration,p.encryptedMovieId)}).on("click",".download-file-button, .download-modal-button",function(){var r=g(this);amplitudeTrackEvent(AMPLITUDE_EVENT.DOWNLOAD_FILE,{type:r.data("fileType"),resolution:r.data("resolution"),video_id:r.data("videoId")});amplitudeIncrementUserProperty(AMPLITUDE_USER_PROPERTY_KEYS.TOTAL_DOWNLOAD_VIDEOS,1)}).on("collaborator-change",function(){p.updateCollaborators()}).on("click",".js-invite-collaborators",function(v){var u=g(this),s=ModalBase.ensure("invite-collaborator-modal"),r=s.data("videoCollaboration"),t="/ajax/getInviteCollaborators/"+p.encryptedMovieId;if(!r){s.data("videoCollaboration",r=new e(s));s.scroll(function(){s.modal("handleUpdate")})}v.preventDefault();r.load(t)}).on("click",".js-manage-collaborators",function(v){var u=g(this),r=ModalBase.ensure("video-collaborator-manager"),t=r.data("videoCollaboratorManager"),s="/ajax/getCollaboratorsManager/"+p.encryptedMovieId;if(!t){r.data("videoCollaboratorManager",t=new l(r));r.scroll(function(){r.modal("handleUpdate")})}v.preventDefault();t.load(s)}).on("click",'[data-action="remove-conversion"]',function(u){u.preventDefault();var r=ModalBase.ensure("video-edit"),t=r.data("videoEdit"),s=g(this).data("video");g.post("/ajax/removePendingConversions/"+s,function(v){if(v.error){t.alert(v.error,"error")}else{t.alert("The conversion process has been cancelled. You can now edit your video. Re-start the conversion process to download/export the most recent version of your video.","success alert-icon");r.find("#video_enabled").show();r.find("#video_disabled").hide()}},"json")}).on("submit",".js-submit-transfer-rights-survey",function(t){t.preventDefault();var s=g(this),r=s.find('[name="response"]:checked'),u=s.find('[name="comment"]');if(r.length===0){return}amplitudeTrackEvent(AMPLITUDE_EVENT.SURVEY_TRANSFER_RIGHTS,{video_id:p.encryptedMovieId,response:r.val(),comment:u.val()});g.post("/ajax/doneTransferRightSurvey");g(".transfer-rights-survey-modal__form, .transfer-rights-survey-modal__done").toggleClass("hidden")}).on("change",'.js-submit-transfer-rights-survey [name="response"]',function(){g(".js-submit-transfer-rights-survey").find('button[type="submit"]').prop("disabled",false)});g("#settings-sidebar-button").click(function(){g("#video-page .player-container .main").addClass("sidebar-on");g("#video-page .player-container .main").addClass("col-sm-7");p.settingsSidebarElem.removeClass("hide")});p.videoCopyingItemElem.on("click",function(){fullscreenStudio("/videomaker/full/copycheck/"+p.encryptedMovieId)});p.initDefaultLogos();p.logoSettingItemElem.on("click",function(){p.logoSettingPanelElem.show();p.historySettingPanelElem.hide();p.notesSettingPanelElem.hide();p.adminPanelElem.hide();p.getLogos();p.slideSettingPanel(true)});p.historySettingItemElem.on("click",function(){p.logoSettingPanelElem.hide();p.historySettingPanelElem.show();p.notesSettingPanelElem.hide();p.adminPanelElem.hide();p.getRevisionHistory();p.slideSettingPanel(true)});p.notesSettingItemElem.on("click",function(){p.logoSettingPanelElem.hide();p.historySettingPanelElem.hide();p.notesSettingPanelElem.show();p.adminPanelElem.hide();p.getNotes(g(this).data("accessId"));p.slideSettingPanel(true)});p.adminItemElem.on("click",function(){p.logoSettingPanelElem.hide();p.historySettingPanelElem.hide();p.notesSettingPanelElem.hide();p.adminPanelElem.show();p.slideSettingPanel(true)});p.panelTitleElem.on("click",function(){p.logoSettingPanelElem.hide();p.historySettingPanelElem.hide();p.notesSettingPanelElem.hide();p.adminPanelElem.hide();p.slideSettingPanel(false);p.loadLatestVideo(false)});p.videoDeletingItemElem.on("click",function(){if(!confirm(GT.gettext("Are you sure you want to delete this video?"))){return}amplitudeIncrementUserProperty(AMPLITUDE_USER_PROPERTY_KEYS.TOTAL_SAVED_VIDEOS,-1);amplitudeTrackEvent(AMPLITUDE_EVENT.DELETED_VIDEO);g.post("/ajax/deleteMovie/"+p.encryptedMovieId,{ct:g('input[name="ct"]').val()},function(r){parseResponse(r);if(responseArray.code=="0"){window.location=responseArray.json.url}else{showNotice(responseArray.json.error,true)}resetResponse()})});p.settingsSidebarElem.on("click",'[data-action="video-export-modal"]',function(u){var t=g(this),s=ModalBase.ensure("video-export"),v=s.data("videoExport"),r=t.data("export-target");u.preventDefault();if(!t.hasClass("download")&&!t.hasClass("youtube")&&t.hasClass("disabled")){return}if(!v){s.data("videoExport",v=new VideoExportModal(s))}v.load(t.data("remote"))})};k.prototype.saveVideoInfo=function(){if(!this.isEditingVideoInfo){return}this.videoPageElem.find(".video-info").removeClass("editing");this.isEditingVideoInfo=false;var s=g(".video-player-viewport").data("h5VideoControl");if(s){s.isEditingVideoInfo=false;s.controlElem.show()}var r=g('input[name="title"]').val();var p=g('textarea[name="desc"]').val();var q=g(".non-edit-fields .title");var o=g(".non-edit-fields .description");if((q.text()==r)&&(o.text()==p)){return}q.text(r);o.html(a(h(p)));g.post("/ajax/updateMovieSettings",{title:r,desc:p,enc_mid:g('input[name="enc_mid"]').val(),ct:g('input[name="ct"]').val()},function(t){if(t.video){g(".non-edit-fields .title").text(t.video.title);g(".non-edit-fields .description").html(a(h(t.video.description)))}})};k.prototype.slideSettingPanel=function(p){var o=this;if(!o.slideAnimationPlaying){o.slideAnimationPlaying=true;o.settingPanelsElem.animate({marginLeft:p?"-100%":"0"},200,function(){o.slideAnimationPlaying=false})}};k.prototype.initDefaultLogos=function(){var o=this;this.defaultLogoListElem.on("click","li",function(r){r.preventDefault();var q=g(this);var p=q.data("watermark");if(q.hasClass("selected")){return}g.post("/ajax/assignwatermark/movie/"+o.encryptedMovieId+"/"+p,function(s){if(s.error){showNotice(s.error,true)}else{o.logoSettingPanelElem.find("[data-watermark]").removeClass("selected");q.addClass("selected");showNotice(s.message);resetPreview()}},"json")})};k.prototype.getLogos=function(){var o=this;o.logoListContainerElem.empty();g.ajax({url:"/ajax/getUserLogoJson/"+o.encryptedMovieId,type:"post",dataType:"json",success:function(q){var t=q.list,p=q.using;var s=t.length;var r=g("<ul></ul>").addClass("logo-list");g.each(t,function(u,w){var v=g("<img />").attr("src",w.url);var x=g('<li data-watermark="'+w.encryptedId+'"></li>').append(v);x.on("click",function(){var y=g(this);if(y.hasClass("selected")){return}var z=g(".video-player-viewport").data("h5VideoControl");z.showLoading();g.post("/ajax/assignwatermark/movie/"+o.encryptedMovieId+"/"+w.encryptedId,function(A){if(A.error){z.hideLoading();showNotice(A.error,true)}else{o.logoSettingPanelElem.find("[data-watermark]").removeClass("selected");y.addClass("selected");showNotice(A.message);resetPreview()}},"json")});r.append(x)});o.logoListContainerElem.append(r);o.logoSettingPanelElem.find("[data-watermark="+p+"]").addClass("selected")}})};k.prototype.loadVideoByRevision=function(p,s){s=!!s;var o=this;var u=g(".video-player-viewport").data("h5VideoControl");var r=(p.type==="current")?GT.gettext("Loading latest version"):GT.strargs("Retrieving revision from %1",[p.EST]);var q=(p.type==="autosave");switchToH5Player(true);u.reset();u.showLoading(r);var t={movieId:this.encryptedMovieId,ts:p.timestamp};g.post("/ajax/getH5CompiledVideoPath",t).done(function(v){window.flashPlayerVars.revaction="e";window.flashPlayerVars.revts=p.timestamp;window.flashPlayerVars.revtype=(q)?"a":"m";window.flashPlayerVars.autostart=(s)?"1":"0";var x=v.url;if(x){var w=g("#h5-player");w.removeAttr("src").empty().append(g("<source>").attr("src",x));if(s){w.get(0).play()}else{u.hideLoading()}}else{resetPreview(p.timestamp,s,q)}o._activeRevision=p})};k.prototype.loadLatestVideo=function(o){if(this._activeRevision!==this._lastestRevision){this.loadVideoByRevision(this._lastestRevision,o)}};k.prototype.getRevisionHistory=function(){var o=this;this.historyListContainerElem.empty();g.ajax({url:"/ajax/getMovieRevisionList/"+o.encryptedMovieId,type:"post",dataType:"json"}).done(function(q){var p=g("<ul></ul>").addClass("history-list");g.each(q,function(u,t){var x=g("<li></li>");if(t.type==="current"){o._lastestRevision=t;o._activeRevision=t;x.addClass("current latest")}x.append(g("<div></div>").text(t.EST).addClass("saved-time"));var r;if(t.type==="autosave"){r=GT.gettext("Autosave")}else{r=GT.gettext("Manual save")+" | "+t.save_by}x.append(g("<div></div>").text(r).addClass("saved-by"));var v=g("<span></span>").addClass("edit-button glyph-pro glyph-pencil");var w=g("<span></span>").addClass("copy-button glyph-pro glyph-more-items");var s=g("<div></div>").addClass("button-container").append(v).append(w);x.append(s);p.append(x);v.on("click",function(){if(t.type==="autosave"){window.location="/videomaker/full/editasrevision/"+o.encryptedMovieId+"/"+t.timestamp}else{window.location="/videomaker/full/editrevision/"+o.encryptedMovieId+"/"+t.timestamp}}).attr("title",GT.gettext("Edit this revision")).tooltip({placement:"bottom"});w.on("click",function(){if(t.type==="autosave"){window.location="/videomaker/full/copyasrevision/"+o.encryptedMovieId+"/"+t.timestamp}else{window.location="/videomaker/full/copyrevision/"+o.encryptedMovieId+"/"+t.timestamp}}).attr("title",GT.gettext("Make a copy")).tooltip({placement:"bottom"});x.on("click",function(y){y.preventDefault();if(g(this).hasClass("current")){return}g(this).addClass("current").siblings().removeClass("current");o.loadVideoByRevision(t,true);amplitudeTrackEvent(AMPLITUDE_EVENT.REVISION_HISTORY,{video_id:o.encryptedMovieId})})});o.historyListContainerElem.append(p)})};k.prototype.getNotes=function(o){if(!this.worknoteModule){this.worknoteModule=new WorknoteModule(this.encryptedMovieId,o,this.notesListContainerElem,f)}this.worknoteModule.load()};k.prototype.updateCollaborators=function(){var o=this;g.post("/ajax/getCollaborators/"+this.encryptedMovieId,function(r){if(r.error){return}var t=[],s=0,q="",p=r.collaborators.length;g(".invite-collaborator-modal__manage-collaborators").toggleClass("hidden",(p===0));if(p>0){g.each(r.collaborators,function(){if(t.length>=2){s++}else{t.push(this.username)}});if(s===0){q=GT.strargs("Shared with %1.",[t.join(", ")])}else{q=GT.strargs(GT.ngettext("Shared with %1 and %2 other.","Shared with %1 and %2 others.",s),[t.join(", "),s])}}g(".invite-collaborator-modal__manage-collaborators__info").text(q);o.collaboratorsElem.html(r.html).find('.avatar, [rel="tooltip"]').tooltip({container:".sharing .collaborators"})})};k.prototype.setPrivacy=function(p){var o=this;var q={enc_mid:this.encryptedMovieId,privacy:p,ct:g('input[name="ct"]').val()};g.post("/ajax/updateMovieSettings",q,function(r){if(r.error){showNotice(r.error,true)}else{var s=r.video.status;o.showPrivacy(s);g('input[name="movie-privacy"]').val(s);o.videoPageElem.find(".settings.social").toggleClass("hidden",g.inArray(s,["draft","password-protected"]));showNotice(GT.gettext("Privacy changed"))}},"json")};k.prototype.showPrivacy=function(o){this.videoPageElem.find(".privacy").removeClass("draft private public password-protected").addClass(o)};k.prototype.toggleSharingUrlDisplay=function(){this.videoPageElem.find(".url-sharing").toggleClass("hidden")};g(document).ready(function(){f=g('input[name="ct"]').val();g(".socials-sharing > li > a").tooltip()});window.VideoPage=k;function a(p){var o="<br>";return(p+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+o+"$2")}function h(o){return document.createElement("a").appendChild(document.createTextNode(o)).parentNode.innerHTML}})(jQuery);var URL_REJECT_MOVIE="/ajax/rejectMovie",URL_TOGGLE_EMBED="/ajax/toggleEmbed";function rejectMovie(b){var c="Are you sure you want to reject this video?";if(!confirm(c)){return}var a=URL_REJECT_MOVIE+"/"+b;jQuery.post(a,function(d){parseResponse(d);if(typeof responseArray.json.url!="undefined"){window.location=responseArray.json.url}else{if(responseArray.code=="0"){displayFeedback(responseArray.code+"Video has been rejected")}else{displayFeedback(responseArray.code+responseArray.json.error)}}resetResponse()})}function enableEmbed(a){toggleEmbed(a,true)}function disableEmbed(a){toggleEmbed(a,false)}function toggleEmbed(a,c){var b=URL_TOGGLE_EMBED+"/"+a;jQuery.post(b,{enable:c},function(d){parseResponse(d);if(responseArray.code==="0"){$('[data-action="disable-embed"]').toggleClass("hidden",!c);$('[data-action="enable-embed"]').toggleClass("hidden",c);displayFeedback(responseArray.code+"Embed code for this user has been "+(c?"enabled":"disabled"))}else{displayFeedback(responseArray.code+responseArray.json.error)}})}var VideoExportModal=function(a,b){var c=this;this.$el=a;this.options=b;this.$el.on("click.video.goanimate","[data-video-export]",function(g){var f=$(this),h=f.attr("href"),d=$('input[name="ct"]').val();g.preventDefault();if(f.data("videoExport")=="youtube"){h=h+"&ct="+encodeURIComponent(d);c.popWindow(h)}else{c.requestExport(h,{ct:d})}}).on("exportError",function(f,d){c.alert(d.error,"error")}).on("exportSuccess",function(f,d){c.requestSuccess(d)})};VideoExportModal.prototype=$.extend({},ModalBase.prototype,{popWindow:function(a){window.open(a,"_go_video_export","toolbar=no,status=no,height=650,width=960")},requestExport:function(a,c){var b=this;$.post(a,c,function(d){if(d.error){b.alert(d.error,"error");return}b.requestSuccess(d)},"json").fail(function(d){b.alert("Error contacting server ("+d.status+"). Please try again later / reload the page.","error")})},requestSuccess:function(b){var a=" a.btn[data-video-export='"+b.type+"']";var d;switch(b.type){case"h5":case"h5presentation":d=GT.gettext("Processing (Beta)");break;default:d=GT.gettext("Processing");break}var c='<span class="btn btn-lg btn-dark">'+d+"...</span>";if(b.resolution){this.$el.find("."+b.resolution+a).replaceWith(c);switch(b.type){case"youtube":this.alert(GT.gettext("Your video is being converted and will be exported to YouTube. You can close this window."));break;default:this.alert(GT.gettext("You will receive an email once your video is ready for download. You can close this window."))}}}});window.isUsingLegacyPlayer=function(){return $(".video-player-viewport").hasClass("using-flash")};window.resetPreview=function(c,b,a){if(previewPlayer===undefined){setupPreviewPlayer()}loadH5Preview(c,b,a)};
