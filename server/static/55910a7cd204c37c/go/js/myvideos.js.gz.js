!function(e){var a="#video-listing";var c="/ajax/myvideos";var b=GT.gettext("Your Videos");var d=function(g,f){var h=this;this.$el=e(g);this.counts={};if(typeof videoCounts=="object"){e.extend(this.counts,videoCounts)}this.endPoint=f;this.options={page:1,sortBy:"lastmod",category:"all",status:"",keyword:""};this.breadcrumbMenu=e(".video-breadcrumb");this.rootEl=this.breadcrumbMenu.find("li").clone();b=this.rootEl.text();this.breadcrumbMenu.on("click","li a",function(i){h.rootEl.text(b);h.breadcrumbMenu.html(h.rootEl);h.updateOptions(h.rootEl.data());e("#videos-nav").find(".active").removeClass("active");e("#videos-nav").find('[data-category="all"]').addClass("active");h.list()});this.updateOptions=function(k){for(var j in k){var i=e.type(k[j]);if(i=="string"||i=="number"){this.options[j]=k[j]}}},this.$el.on("click.myvideos.goanimate",".go-pagination a",function(j){var i=e(this);j.preventDefault();if(i.parent().hasClass("disabled")){return}h.options.page=i.data("page");h.list()}).on("submit",".go-pagination-form",function(k){var j=e(this);k.preventDefault();var i=parseInt(j.find('input[name="page"]').val(),10);if(i<=0||i>j.data("maxPage")){alert(GT.gettext("Please input a valid page number"));return}h.options.page=i;h.list()}).on("click","#videos-nav > .folder-item > .caret-container",function(i){i.preventDefault();e(this).find(".caret").toggleClass("closed");e("#videos-folders-nav").toggle()}).on("click","#videos-nav > .folder-item",function(j){var i=e(this);j.preventDefault();if(i.hasClass("active")){return}h.updateOptions(i.data());i.parent().find("div.active").removeClass("active").end().end().addClass("active");var k=i.find(".folder-name").text();h.rootEl.text(k);h.breadcrumbMenu.html(h.rootEl);h.list()}).on("click","#videos-nav > .sub-folder-list .sub-folder-item",function(j){var i=e(this);j.preventDefault();if(i.hasClass("active")){return}h.updateOptions(i.data());i.parent().siblings().removeClass("active");i.siblings().removeClass("active");i.addClass("active");h.breadcrumbMenu.empty();h.rootEl.html(e('<a class="link-secondary"></a>').attr("href","#").text(b));h.breadcrumbMenu.append(h.rootEl);h.breadcrumbMenu.append(e("<li></li>").data("folder-id",i.data("folder-id")).text(i.data("folder-name")));h.list()}).on("click",".video-status-filter a",function(k){var j=e(this);k.preventDefault();if(j.hasClass("active")){return}var i=j.data("action");if(i=="upsell-freetrial"){return}h.options.status=j.data("status");h.options.page=1;j.siblings().removeClass("active").end().addClass("active");h.list()}).on("click","#videos-nav > li.nav-folders-trigger > .folder-caret-container",function(i){i.preventDefault();e(this).find(".folder-caret").toggleClass("show-list").toggleClass("hide-list");e("#videos-folders-nav").toggle()});this.$el.find('[rel="tooltip"]').tooltip();e(document).on("published","#video-share",function(j,i){h.updateVideo(i)}).on("saved","#video-settings",function(j,i){h.updateVideo(i)}).on("videoDeleted",function(i,j){if(j){h.counts.all--}h.counts.trash++;h.updateCounts();h.updateFolderList()}).on("videoRestored",function(j,i){if(i){h.counts.all++}h.counts.trash--;h.updateCounts();h.updateFolderList()})};d.prototype={list:function(){this.$el.find('[rel="tooltip"]').tooltip("destroy");this.$el.find("#video-listing-grid").addClass("loading");e.post(this.endPoint,this.options,e.proxy(this.render,this))},render:function(f){this.$el.find("#video-listing-grid").replaceWith(f);this.updateTitle();this.$el.find('[rel="tooltip"]').tooltip();this.prepareDraggable();scrollTo(0,0)},updateVideo:function(g){var f=e("#video-"+g.videoId);if(f.length==0){return}f.find(".status").attr("class","status "+g.status);f.find(".title").text(g.title)},updateCounts:function(){for(var f in this.counts){e(".count-"+f).text(this.counts[f].toLocaleString())}},updateTitle:function(){var f=GT.gettext("Your Videos on Vyond");switch(this.options.category){case"fav":f=GT.gettext("Videos you added to your Favorites on Vyond");break;case"trash":f=GT.gettext("Videos you deleted on Vyond");break}document.title=f},prepareDraggable:function(){if((this.options.category!="fav")&&(this.options.category!="trash")&&(this.options.category!="folders/sharedwith")){this.$el.find(".draggable-row").draggable({appendTo:"body",cursor:"move",cursorAt:{left:5,top:5},revert:false,helper:"clone",distance:10,zIndex:100,start:function(f,g){var i=g.helper.find(".title").text();var h=g.helper.find("img").attr("src");g.helper.empty();g.helper.append(e("<img />").attr("src",h));g.helper.append(e("<span></span>").addClass("title").text(i));g.helper.addClass("movie-drag")}})}},prepareDroppable:function(){var f=this;e("#videos-nav .droppable").droppable({hoverClass:"drag-hover",tolerance:"pointer",drop:function(i,k){var h=e(this);var j={video_id:k.draggable.attr("data-drag-video"),current_folder_id:k.draggable.attr("data-drag-video-current-folder"),folder_id:h.attr("data-folder-id")};var g=(j.current_folder_id==="")?"/ajax/addMovieToFolder":"/ajax/moveMovieToFolder";if(((j.current_folder_id==="")&&(j.folder_id!==""))||(j.current_folder_id!=j.folder_id)){e("#video-"+j.video_id).hide();e.post(g,j,function(m){if(m.error){var l=e('<div class="alert"><button type="button" class="close" data-dismiss="alert">&times;</button></div>');l.addClass("alert-error").append(m.error).prependTo(e(".main-container"));return}var o=(j.current_folder_id==="")?"all":j.current_folder_id;f.counts[o]--;var n=(j.folder_id==="")?"all":j.folder_id;f.counts[n]++;f.list();f.updateCounts()})}}});e("#videos-folders-nav li.drop-region, #videos-nav > li.drop-region").droppable({hoverClass:"drag-hover",tolerance:"pointer",drop:function(i,k){var h=e(this);e(".main-container").find(".alert-error").remove();var j={};j.video_id=k.draggable.attr("data-drag-video");j.current_folder_id=k.draggable.attr("data-drag-video-current-folder");j.folder_id=h.attr("data-folder-id");if(((j.current_folder_id==="")&&(j.folder_id!==""))||j.current_folder_id!=j.folder_id){e("#video-"+j.video_id).hide();var g=(j.current_folder_id==="")?"/ajax/addMovieToFolder":"/ajax/moveMovieToFolder";e.post(g,j,function(n){if(n.error){var l=e('<div class="alert"><button type="button" class="close" data-dismiss="alert">&times;</button></div>');l.addClass("alert-error").append(n.error).prependTo(e(".main-container"));return}var m=parseInt(e("#videos-nav").find('.drop-region[data-folder-id="'+j.current_folder_id+'"] .video-count').text())-1;var p=(j.current_folder_id==="")?"all":"folders/"+j.current_folder_id;e("#videos-nav").find('.drop-region[data-folder-id="'+j.current_folder_id+'"] .video-count').text(m);var o=parseInt(h.find(".video-count").text())+1;var q=(j.folder_id==="")?"all":"folders/"+j.folder_id;h.find(".video-count").text(o);f.list()})}}})},updateFolderList:function(){if(e("#videos-nav").hasClass("folder-access")){var f=this;e.get("/ajax/getUserMovieFolders",function(l){if(l.folder_list){e("#videos-folders-nav").empty();if((l.folder_list).length>0){for(var m=0,h=(l.folder_list).length;m<h;++m){var k=l.folder_list[m],j=k.enc_fid,g=parseInt(k.cnt,10),n=e('<div class="sub-folder-item droppable"></div>'),o=e('<span class="video-count"></span>').text(g);o.addClass("count-"+j);n.append('<a><span class="glyph-pro glyph-folder-closed icon"></span></a>');n.append(e('<span class="folder-name"></span>').text(k.name));n.append(" (");n.append(o);n.append(")");n.append('<span class="glyph-pro glyph-cogwheel setting-btn" data-remote="/ajax/getFolderEdit/'+j+'" data-action="folder-edit"></span>');n.attr({"data-folder-id":j,"data-folder-name":k.name,"data-category":"folders/"+j,"data-page":"1","data-sort-by":"lastmod","data-status":"","data-keyword":""});e("#videos-folders-nav").append(n);f.counts[j]=g}f.prepareDroppable()}folderCounts=l.folder_list.length}})}}};myVideos=new d(a,c);myVideos.prepareDraggable();myVideos.updateFolderList()}(jQuery);
