(function(h,n){var e=20,y=45,m=0.09,g={PAUSED:"paused",PLAYING:"playing",ENDED:"ended"},w={NON_PLAYING:"non-playing",PLAYING:"playing"},q=10,f=200,b=20000,r=GT.gettext("Sorry, your video is taking longer than usual to load. <br> Please wait a moment."),l=GT.gettext("We are optimizing this video to be compatible with your browser. <br> Please wait a few minutes then refresh this page."),k=200,d=1000;var o=(navigator.userAgent.match(/(iPod|iPhone|iPad)/)!==null),t=((navigator.userAgent.indexOf("Safari")>-1)&&(navigator.userAgent.indexOf("Chrome")===-1)),x=t&&(s()<q),v=(navigator.vendor.indexOf("Apple Computer")>-1);var j,p;function s(){var B=navigator.userAgent.match(/version\/([0-9\.]+)/i);return B?parseFloat(B[1]):-1}function i(D,B){var C=false;return function(){if(!C){D.call();C=true;setTimeout(function(){C=false},B)}}}function z(B){h("body").css({"-webkit-touch-callout":B,"-webkit-user-select":B,"-moz-user-select":B,"-ms-user-select":B,"user-select":B})}function u(){var B="ontouchstart" in document.createElement("div");return(B)?true:false}function a(){var B=document.createElement("video");B.volume=0.5;return(B.volume===1)}var A=function(B){this.viewportElem=B;this.videoPlayerWrapper=B.find(".video-player-wrapper");this.infoOverlayElem=B.find(".video-info");this.loadingOverlay=B.find("#video-loading");this.videoElem=B.find("#h5-player");this.controlElem=B.find("#player-control");this.videoDom=this.videoElem.get(0);this.paused=this.videoDom.paused;this.videoLoaded=false;this.videoPlayStarted=false;this.isEditingVideoInfo=false;this.isDraggingSeekBar=false;this.isDraggingVolumeSlider=false;this.hideSeekBarAfterDrag=false;this.isFullScreenMode=false;this.videoVolumeReadOnly=a();this.encryptedVideoId=this.infoOverlayElem.data("videoId");this.isVideoOwner=this.infoOverlayElem.data("isOwner");this.ownerId=this.infoOverlayElem.data("owner");this.videoDuration=this.infoOverlayElem.data("duration");this.initElements();this.initEventListeners()};A.prototype.initElements=function(){this.contextMenuElem=h("#context-menu");this.playbackButton=this.controlElem.find(".playback-button");this.seekBar=this.controlElem.find(".seek-bar");this.seekBarContainer=this.controlElem.find(".seek-bar-container");this.playedBar=this.seekBar.find(".played-bar");this.bufferedBar=this.seekBar.find(".buffered-bar");this.hoverBar=this.seekBar.find(".hover-bar");this.seekBarTooltip=this.seekBar.find(".time-tooltip");this.volumeControlElem=this.controlElem.find(".volume-control");this.volumeIcon=this.volumeControlElem.find(".volume-icon");this.volumeSlider=this.volumeControlElem.find(".volume-slider");this.volumeSliderThumb=this.volumeSlider.find(".slider-thumb");this.volumeSliderValueBar=this.volumeSlider.find(".slider-track .track-value-bar");this.fullScreenButton=this.controlElem.find(".fullscreen-button");this.progressTime=this.controlElem.find(".progress-time");this.volumeSliderWidth=this.volumeSlider.width();this.unmuteVolume=1;this.mouseDownOnSeekBar=false;this.pausedBeforeMouseDownOnSeekBar=true;if(this.videoVolumeReadOnly){this.volumeControlElem.hide()}this.progressTime.text(this.formatTime(0)+" / "+this.formatTime(this.videoDuration))};A.prototype.initEventListeners=function(){var K=this;this.contextMenuElem.on("contextmenu",function(M){M.preventDefault();K.closeContextMenu()});this.contextMenuElem.find(".click-disabler").on("mousedown click contextmenu",function(M){M.preventDefault();K.closeContextMenu()});this.contextMenuElem.find("[data-player-action]").on("click",function(M){K.closeContextMenu();switch(h(this).data("playerAction")){case"play":K.playbackHandler();break;case"copyUrl":K.copyToClipboard(videoCopyableUrl,M);break;case"copyEmbedCode":K.copyToClipboard(h("#embed_code_field").val(),M);break}});this.viewportElem.on("contextmenu",function(M){if(K.isEditingVideoInfo){return}K.contextMenuHandler(M)});h(document).on("scroll",function(M){if(K.contextMenuOpening===true){M.preventDefault();K.closeContextMenu()}});var E=i(h.proxy(this.setHideControlsTimeout,this),k);this.viewportElem.on("mouseenter",function(){if(K.videoPlayStarted&&!K.isEditingVideoInfo){if(!K.isDraggingSeekBar&&!K.isDraggingVolumeSlider){K.showControls()}else{K.hideSeekBarAfterDrag=false}}}).on("mouseleave",function(){if(K.videoPlayStarted&&!K.isEditingVideoInfo){if(!K.isDraggingSeekBar&&!K.isDraggingVolumeSlider){K.hideControls()}else{K.hideSeekBarAfterDrag=true}}});h(document).on("webkitfullscreenchange mozfullscreenchange MSFullscreenChange fullscreenchange",function(){if(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement){K.isFullScreenMode=true;K.viewportElem.on("mousemove",E)}else{K.exitFullScreenHandler();K.isFullScreenMode=false;K.viewportElem.off("mousemove",E)}});this.videoPlayerWrapper.on("click",function(){if(!isUsingLegacyPlayer()){K.playbackHandler()}});this.videoElem.on("loadeddata",function(){K.videoLoaded=true}).on("ended",function(){K.clearHideControlsTimeout();K.paused=true;K.setPlaybackButtonState(g.ENDED);K.setControlElemState(w.NON_PLAYING);K.videoPlayStarted=false;K.hideLoading();K.showControls()}).on("pause",function(){K.clearHideControlsTimeout();K.paused=true;K.setPlaybackButtonState(g.PAUSED);K.setControlElemState(w.NON_PLAYING);if(K.isDraggingSeekBar){K.infoOverlayElem.hide()}else{K.infoOverlayElem.fadeIn(f)}if(K.isFullScreenMode){K.showControls()}}).on("play",function(){K.paused=false;if(o&&this.webkitEnterFullscreen){this.webkitEnterFullscreen()}K.showControls();K.setPlaybackButtonState(g.PLAYING);K.setControlElemState(w.PLAYING);K.infoOverlayElem.hide();if(!K.videoPlayStarted){K.videoPlayStarted=true;K.videoElem.removeClass("hidden")}if(K.isFullScreenMode){K.setHideControlsTimeout()}}).on("playing",function(){K.paused=false;K.setPlaybackButtonState(g.PLAYING);K.setControlElemState(w.PLAYING);K.hideLoading();if(K.videoPlayStarted&&x&&(K.videoDom.currentTime>=m)&&(K.safariHackItr!==undefined)){clearInterval(K.safariHackItr);K.safariHackItr=undefined}}).on("waiting",function(){var M=null;if(!n.MediaSource){M=l}K.showLoading(M);if(K.videoPlayStarted&&x&&(K.videoDom.currentTime===0)&&(K.safariHackItr===undefined)){K.safariHackItr=setInterval(function(){if(!K.videoDom.paused&&(K.videoDom.currentTime<m)&&(K.videoDom.duration>m)){try{K.videoDom.currentTime=m}catch(N){}}},y)}});h5PlayerElem=this.videoElem;if(!this.videoVolumeReadOnly){var G={start:"mousedown",move:"mousemove",end:"mouseup"};if(u()){G={start:"touchstart",move:"touchmove",end:"touchend"}}this.volumeIcon.on("click",function(){if(K.videoDom.volume===0){K.videoDom.volume=K.unmuteVolume;K.volumeControlElem.removeClass("muted")}else{K.unmuteVolume=K.videoDom.volume;K.videoDom.volume=0;K.volumeControlElem.addClass("muted")}var M=(K.videoDom.volume*100)+"%";K.volumeSliderThumb.css("left",M);K.volumeSliderValueBar.css("width",M)});var D=function(Q){var M=h(K.volumeSlider).offset();var O=Q.originalEvent.pageX;if(Q.originalEvent.touches){O=Q.originalEvent.touches[0].pageX}var N=O-M.left;N=Math.max(0,N);N=Math.min(K.volumeSliderWidth,N);K.volumeControlElem.toggleClass("muted",(N===0));K.volumeSliderThumb.css("left",N);K.volumeSliderValueBar.css("width",N);var P=N/K.volumeSliderWidth;K.videoDom.volume=P};var J=function(M){D(M);K.isDraggingVolumeSlider=true};var C=function(){z("");K.isDraggingVolumeSlider=false;h(document).off(G.move,J);h(document).off(G.end,C)};this.volumeSlider.on(G.start,function(){z("none");h(document).on(G.move,J);h(document).on(G.end,C)});this.volumeSlider.on("click",D)}setInterval(function(){var N=K.seekBar.width(),M=K.videoDom.duration,O=K.videoDom.buffered.length,S=K.videoDom.currentTime;if(O===1){K.bufferedBar.width(K.videoDom.buffered.end(0)/M*N)}else{if(O>1){var R,P;for(var Q=0;Q<O;Q++){R=K.videoDom.buffered.start(Q);P=K.videoDom.buffered.end(Q);if((S>=R)&&(S<=P)){K.bufferedBar.width(P/M*N);break}}}}if(!K.videoLoaded){return}K.progressTime.text(K.formatTime(S)+" / "+K.formatTime(K.videoDom.duration));K.playedBar.width(S/M*N)},e);var I="mousedown",H="mousemove",B="mouseup";if(u()){I="touchstart";H="touchmove";B="touchend"}var F=function(R){if((R.type==="mousedown")||(R.type==="touchstart")){K.pausedBeforeMouseDownOnSeekBar=K.paused;K.videoDom.pause();K.mouseDownOnSeekBar=true}var N=h(K.seekBar).offset();var O=R.originalEvent.pageX;if(R.originalEvent.touches){O=R.originalEvent.touches[0].pageX}var Q=O-N.left;var M=K.seekBar.width();Q=Math.max(0,Q);Q=Math.min(M,Q);K.seekBarTooltip.css("left",Q);var P=Q/M*K.videoDom.duration;if(P<0){P=0}else{if(P>K.videoDom.duration){P=K.videoDom.duration}}K.seekBarTooltip.text(K.formatTime(P));K.hoverBar.width(Q);if((K.mouseDownOnSeekBar)&&(K.seekBar.width()!==0)){K.playedBar.width(Q);K.videoDom.currentTime=Q/K.seekBar.width()*K.videoDom.duration}};if(!u()){this.seekBarContainer.on("mousemove",function(M){F(M)})}var L=function(M){z("");if(K.hideSeekBarAfterDrag){K.hideControls()}if(!K.pausedBeforeMouseDownOnSeekBar){K.videoDom.play();amplitudeTrackEvent(AMPLITUDE_EVENT.PLAYS_VIDEO,{movie:K.encryptedVideoId,Referral:document.referrer,Owner:K.isVideoOwner,OwnerID:K.ownerId})}else{K.infoOverlayElem.show()}K.pausedBeforeMouseDownOnSeekBar=false;K.isDraggingSeekBar=false;K.hideSeekBarAfterDrag=false;K.mouseDownOnSeekBar=false;h(document).off(H,F);h(document).off(B,L)};this.seekBarContainer.on(I,function(M){z("none");K.isDraggingSeekBar=true;K.hideSeekBarAfterDrag=false;K.infoOverlayElem.hide();F(M);h(document).on(H,F);h(document).on(B,L)});this.seekBarContainer.on("click",F);this.playbackButton.on("click",function(){K.playbackHandler()});this.fullScreenButton.on("click",function(){K.fullScreenHandler()});h(document).keydown(function(N){if(isUsingLegacyPlayer()){return}var M=N.target.tagName.toLowerCase();if((M==="input")||(M==="textarea")){return}if(K.isFullScreen()||!K.paused){switch(N.keyCode){case 27:N.preventDefault();K.exitFullScreenHandler();break;case 32:case 75:N.preventDefault();K.playbackHandler();break;case 37:N.preventDefault();K.backwardHandler();break;case 39:N.preventDefault();K.forwardHandler();break;case 70:N.preventDefault();K.fullScreenHandler();break}}else{if(N.keyCode===70){N.preventDefault();K.fullScreenHandler()}else{if(N.keyCode===75){N.preventDefault();K.playbackHandler()}}}})};A.prototype.playbackHandler=function(){if(this.paused){this.videoDom.play();amplitudeTrackEvent(AMPLITUDE_EVENT.PLAYS_VIDEO,{movie:this.encryptedVideoId,Referral:document.referrer,Owner:this.isVideoOwner,OwnerID:this.ownerId})}else{this.videoDom.pause()}};A.prototype.pause=function(){if(this.videoDom&&!this.paused){this.videoDom.pause()}};A.prototype.isFullScreen=function(){return(document.fullscreenElement&&(document.fullscreenElement!==null))||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement};A.prototype.exitFullScreenHandler=function(){if(document.exitFullScreen){document.exitFullScreen()}else{if(document.msExitFullscreen){document.msExitFullscreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitExitFullscreen){document.webkitExitFullscreen()}}}}};A.prototype.fullScreenHandler=function(){if(o&&this.videoDom.webkitEnterFullscreen){this.videoDom.webkitEnterFullscreen();return}if(this.isFullScreen()){this.exitFullScreenHandler();this.clearHideControlsTimeout()}else{var B=this.viewportElem.get(0);if(B.requestFullscreen){B.requestFullscreen()}else{if(B.msRequestFullscreen){B.msRequestFullscreen()}else{if(B.mozRequestFullScreen){B.mozRequestFullScreen()}else{if(B.webkitRequestFullscreen){B.webkitRequestFullscreen()}}}}amplitudeTrackEvent(AMPLITUDE_EVENT.TOGGLE_FULLSCREEN,{movie:this.encryptedVideoId})}};A.prototype.setHideControlsTimeout=function(){var B=this;this.showControls();if(!this.paused){this.clearHideControlsTimeout();p=setTimeout(function(){B.hideControls();p=null},d)}};A.prototype.clearHideControlsTimeout=function(){if(p){clearTimeout(p);p=null}};A.prototype.backwardHandler=function(){this.videoDom.currentTime=Math.max(0,this.videoDom.currentTime-5)};A.prototype.forwardHandler=function(){this.videoDom.currentTime=Math.min(this.videoDom.currentTime+5,this.videoDom.duration)};A.prototype.contextMenuHandler=function(E){var B=E.target.tagName.toLowerCase();if((B==="input")||(B==="textarea")){return}E.preventDefault();this.contextMenuOpening=true;var D=E.clientX,C=E.clientY;if(x&&v){this.contextMenuElem.find('[data-player-action="copyUrl"], [data-player-action="copyEmbedCode"]').addClass("hidden")}this.contextMenuElem.css("top",C).css("left",D).removeClass("hidden")};A.prototype.closeContextMenu=function(){this.contextMenuElem.addClass("hidden");this.contextMenuOpening=false};A.prototype.copyToClipboard=function(F,E){var D=document.createElement("textarea");D.style.position="absolute";D.style.left="-9999px";if(E!==undefined){D.style.top=E.pageY+"px"}else{D.style.top="0"}document.body.appendChild(D);D.textContent=F;var G=document.activeElement;D.focus();D.setSelectionRange(0,D.value.length);var C;try{C=document.execCommand("copy")}catch(B){C=false}if(G&&(typeof G.focus==="function")){G.focus()}return C};A.prototype.formatTime=function(D){if(isNaN(D)){return"00:00"}D=Math.round(D);var B=Math.floor(D/60),C=D%60;if(B<10){B="0"+B}if(C<10){C="0"+C}return B+":"+C};A.prototype.showControls=function(){if(this.paused&&!this.isDraggingSeekBar){this.infoOverlayElem.fadeIn(f)}this.controlElem.not(":visible").fadeIn(f)};A.prototype.hideControls=function(){this.infoOverlayElem.hide();this.controlElem.hide()};A.prototype.showLoading=function(B){var C=this.loadingOverlay.find(".video-loading-message");if(typeof B==="string"){C.html(B)}else{if(!j){j=setTimeout(function(){C.html(r)},b)}}this.loadingOverlay.show()};A.prototype.hideLoading=function(){if(j){clearTimeout(j);j=null}this.loadingOverlay.find(".video-loading-message").empty();this.loadingOverlay.hide()};A.prototype.setPlaybackButtonState=function(B){this.playbackButton.removeClass(g.PAUSED);this.playbackButton.removeClass(g.PLAYING);this.playbackButton.removeClass(g.ENDED);this.playbackButton.addClass(B)};A.prototype.setControlElemState=function(B){this.controlElem.removeClass(w.PLAYING);this.controlElem.removeClass(w.NON_PLAYING);this.controlElem.addClass(B)};A.prototype.reset=function(){if(!this.paused){this.videoDom.pause()}this.videoDom.currentTime=0;this.videoPlayStarted=false;this.isEditingVideoInfo=false;this.hideLoading();this.infoOverlayElem.show();this.controlElem.show();this.setPlaybackButtonState(g.PAUSED);this.setControlElemState(w.NON_PLAYING);this.videoElem.addClass("hidden")};var c=new A(h(".video-player-viewport"));h(".video-player-viewport").data("h5VideoControl",c)})(jQuery,window);
