(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{if(typeof exports==="object"){a(require("jquery"))}else{a(jQuery)}}}(function(c){var b=function(g,h){var i=this;this.$element=c(g);this.textDirection=this.$element.css("direction");this.options=c.extend(true,{},c.fn.tokenfield.defaults,{tokens:this.$element.val()},this.$element.data(),h);this._delimiters=(typeof this.options.delimiter==="string")?[this.options.delimiter]:this.options.delimiter;this._triggerKeys=c.map(this._delimiters,function(w){return w.charCodeAt(0)});this._firstDelimiter=this._delimiters[0];var s=c.inArray(" ",this._delimiters),o=c.inArray("-",this._delimiters);if(s>=0){this._delimiters[s]="\\s"}if(o>=0){delete this._delimiters[o];this._delimiters.unshift("-")}var m=["\\","$","[","{","^",".","|","?","*","+","(",")"];c.each(this._delimiters,function(x,w){var y=c.inArray(w,m);if(y>=0){i._delimiters[x]="\\"+w}});var n=(typeof window.getMatchedCSSRules==="function")?window.getMatchedCSSRules(g):null,d=g.style.width,t,q=this.$element.width();if(n){c.each(n,function(w,x){if(x.style.width){t=x.style.width}})}var l=c("body").css("direction")==="rtl"?"right":"left",p={position:this.$element.css("position")};p[l]=this.$element.css(l);this.$element.data("original-styles",p).data("original-tabindex",this.$element.prop("tabindex")).css("position","absolute").css(l,"-10000px").prop("tabindex",-1);this.$wrapper=c('<div class="tokenfield form-control" />');var u=["input-lg","input-sm","input-mini","input-small","input-medium","input-large","input-xlarge","input-xxlarge"];var k=null;for(k in u){if(this.$element.hasClass(u[k])){this.$wrapper.addClass(u[k])}}if(this.textDirection==="rtl"){this.$wrapper.addClass("rtl")}var r=this.$element.prop("id")||new Date().getTime()+""+Math.floor((1+Math.random())*100);this.$input=c('<input type="text" class="token-input" autocomplete="off" />').appendTo(this.$wrapper).prop("placeholder",this.$element.prop("placeholder")).prop("id",r+"-tokenfield");var v=c('label[for="'+this.$element.prop("id")+'"]');if(v.length){v.prop("for",this.$input.prop("id"))}this.$copyHelper=c('<input type="text" />').css("position","absolute").css(l,"-10000px").prop("tabindex",-1).prependTo(this.$wrapper);if(d){this.$wrapper.css("width",d)}else{if(t){this.$wrapper.css("width",t)}else{if(this.$element.parents(".form-inline").length){this.$wrapper.width(q)}}}if(this.$element.prop("disabled")||this.$element.parents("fieldset[disabled]").length){this.disable()}this.$mirror=c('<span style="position:absolute; top:-999px; left:0; white-space:pre;"/>');this.$input.css("min-width",this.options.minWidth+"px");c.each(["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],function(w,x){i.$mirror[0].style[x]=i.$input.css(x)});this.$mirror.appendTo("body");this.$wrapper.insertBefore(this.$element);this.$element.prependTo(this.$wrapper);this.update();this.setTokens(this.options.tokens,false,false);this.listen();if(!c.isEmptyObject(this.options.autocomplete)){var f=this.textDirection==="rtl"?"right":"left";var j=c.extend({minLength:this.options.showAutocompleteOnFocus?0:null,position:{my:f+" top",at:f+" bottom",of:this.$wrapper}},this.options.autocomplete);this.$input.autocomplete(j)}if(!c.isEmptyObject(this.options.typeahead)){var e=c.extend({minLength:this.options.showAutocompleteOnFocus?0:null},this.options.typeahead);this.$input.typeahead(null,e);this.typeahead=true}this.$element.trigger("tokenfield:initialize")};b.prototype={constructor:b,createToken:function(o,g){if(typeof o==="string"){o={value:o,label:o}}if(typeof g==="undefined"){g=true}var k=this,n=c.trim(o.value),l=o.label&&o.label.length?c.trim(o.label):n;if(!n.length||!l.length||n.length<this.options.minLength){return}if(this.options.limit&&this.getTokens().length>=this.options.limit){return}var i=c.Event("tokenfield:preparetoken");i.token={value:n,label:l};this.$element.trigger(i);if(!i.token){return}n=i.token.value;l=i.token.label;if(!this.options.allowDuplicates&&c.grep(this.getTokens(),function(q){return q.value===n}).length){var e=c.Event("tokenfield:preventduplicate");e.token={value:n,label:l};this.$element.trigger(e);var h=this.$wrapper.find('.token[data-value="'+n+'"]').addClass("duplicate");setTimeout(function(){h.removeClass("duplicate")},250);return false}var f=c('<div class="token" />').attr("data-value",n).append('<span class="token-label" />').append('<a href="#" class="close" tabindex="-1">&times;</a>');if(this.$input.hasClass("tt-input")){this.$input.parent().before(f)}else{this.$input.before(f)}this.$input.css("width",this.options.minWidth+"px");var j=f.find(".token-label"),d=f.find(".close");if(!this.maxTokenWidth){this.maxTokenWidth=this.$wrapper.width()-d.outerWidth()-parseInt(d.css("margin-left"),10)-parseInt(d.css("margin-right"),10)-parseInt(f.css("border-left-width"),10)-parseInt(f.css("border-right-width"),10)-parseInt(f.css("padding-left"),10)-parseInt(f.css("padding-right"),10);parseInt(j.css("border-left-width"),10)-parseInt(j.css("border-right-width"),10)-parseInt(j.css("padding-left"),10)-parseInt(j.css("padding-right"),10);parseInt(j.css("margin-left"),10)-parseInt(j.css("margin-right"),10)}j.text(l).css("max-width",this.maxTokenWidth);f.on("mousedown",function(q){if(k.disabled){return false}k.preventDeactivation=true}).on("click",function(q){if(k.disabled){return false}k.preventDeactivation=false;if(q.ctrlKey||q.metaKey){q.preventDefault();return k.toggle(f)}k.activate(f,q.shiftKey,q.shiftKey)}).on("dblclick",function(q){if(k.disabled||!k.options.allowEditing){return false}k.edit(f)});d.on("click",c.proxy(this.remove,this));var p=c.Event("tokenfield:createtoken");p.token=i.token;p.relatedTarget=f.get(0);this.$element.trigger(p);var m=c.Event("change");m.initiator="tokenfield";if(g){this.$element.val(this.getTokensList()).trigger(m)}this.update();return this.$input.get(0)},setTokens:function(g,f,e){if(!g){return}if(!f){this.$wrapper.find(".token").remove()}if(typeof e==="undefined"){e=true}if(typeof g==="string"){if(this._delimiters.length){g=g.split(new RegExp("["+this._delimiters.join("")+"]"))}else{g=[g]}}var d=this;c.each(g,function(j,h){d.createToken(h,e)});return this.$element.get(0)},getTokenData:function(d){var e=d.map(function(){var f=c(this);return{value:f.attr("data-value"),label:f.find(".token-label").text()}}).get();if(e.length==1){e=e[0]}return e},getTokens:function(g){var d=this,f=[],e=g?(("boolean"==typeof(g))?".active":g):"";this.$wrapper.find(".token"+e).each(function(){f.push(d.getTokenData(c(this)))});return f},getTokensList:function(d,e,g){d=d||this._firstDelimiter;e=(typeof e!=="undefined"&&e!==null)?e:this.options.beautify;var f=d+(e&&d!==" "?" ":"");return c.map(this.getTokens(g),function(h){return h.value}).join(f)},getInput:function(){return this.$input.val()},listen:function(){var d=this;this.$element.on("change",c.proxy(this.change,this));this.$wrapper.on("mousedown",c.proxy(this.focusInput,this));this.$input.on("focus",c.proxy(this.focus,this)).on("blur",c.proxy(this.blur,this)).on("paste",c.proxy(this.paste,this)).on("keydown",c.proxy(this.keydown,this)).on("keypress",c.proxy(this.keypress,this)).on("keyup",c.proxy(this.keyup,this));this.$copyHelper.on("focus",c.proxy(this.focus,this)).on("blur",c.proxy(this.blur,this)).on("keydown",c.proxy(this.keydown,this)).on("keyup",c.proxy(this.keyup,this));this.$input.on("keypress",c.proxy(this.update,this)).on("keyup",c.proxy(this.update,this));this.$input.on("autocompletecreate",function(){var e=c(this).data("ui-autocomplete").menu.element;var f=d.$wrapper.outerWidth()-parseInt(e.css("border-left-width"),10)-parseInt(e.css("border-right-width"),10);e.css("min-width",f+"px")}).on("autocompleteselect",function(g,f){if(d.createToken(f.item)){d.$input.val("");if(d.$input.data("edit")){d.unedit(true)}}return false}).on("typeahead:selected",function(h,f,g){if(d.createToken(f)){d.$input.typeahead("val","");if(d.$input.data("edit")){d.unedit(true)}}}).on("typeahead:autocompleted",function(h,f,g){d.createToken(d.$input.val());d.$input.typeahead("val","");if(d.$input.data("edit")){d.unedit(true)}});c(window).on("resize",c.proxy(this.update,this))},keydown:function(h){if(!this.focused){return}var d=this;switch(h.keyCode){case 8:if(!this.$input.is(document.activeElement)){break}this.lastInputValue=this.$input.val();break;case 37:g(this.textDirection==="rtl"?"next":"prev");break;case 38:f("prev");break;case 39:g(this.textDirection==="rtl"?"prev":"next");break;case 40:f("next");break;case 65:if(this.$input.val().length>0||!(h.ctrlKey||h.metaKey)){break}this.activateAll();h.preventDefault();break;case 9:case 13:if(this.$input.data("ui-autocomplete")&&this.$input.data("ui-autocomplete").menu.element.find("li:has(a.ui-state-focus)").length){break}if(this.$input.hasClass("tt-input")&&this.$wrapper.find(".tt-cursor").length){break}if(this.$input.hasClass("tt-input")&&this.$wrapper.find(".tt-hint").val().length){break}if(this.$input.is(document.activeElement)&&this.$input.val().length||this.$input.data("edit")){return this.createTokensFromInput(h,this.$input.data("edit"))}if(h.keyCode===13){if(!this.$copyHelper.is(document.activeElement)||this.$wrapper.find(".token.active").length!==1){break}if(!d.options.allowEditing){break}this.edit(this.$wrapper.find(".token.active"))}}function g(i){if(d.$input.is(document.activeElement)){if(d.$input.val().length>0){return}i+="All";var e=d.$input.hasClass("tt-input")?d.$input.parent()[i](".token:first"):d.$input[i](".token:first");if(!e.length){return}d.preventInputFocus=true;d.preventDeactivation=true;d.activate(e);h.preventDefault()}else{d[i](h.shiftKey);h.preventDefault()}}function f(k){if(!h.shiftKey){return}if(d.$input.is(document.activeElement)){if(d.$input.val().length>0){return}var i=d.$input.hasClass("tt-input")?d.$input.parent()[k+"All"](".token:first"):d.$input[k+"All"](".token:first");if(!i.length){return}d.activate(i)}var j=k==="prev"?"next":"prev",e=k==="prev"?"first":"last";d.firstActiveToken[j+"All"](".token").each(function(){d.deactivate(c(this))});d.activate(d.$wrapper.find(".token:"+e),true,true);h.preventDefault()}this.lastKeyDown=h.keyCode},keypress:function(d){this.lastKeyPressCode=d.keyCode;this.lastKeyPressCharCode=d.charCode;if(c.inArray(d.charCode,this._triggerKeys)!==-1&&this.$input.is(document.activeElement)){if(this.$input.val()){this.createTokensFromInput(d)}return false}},keyup:function(f){this.preventInputFocus=false;if(!this.focused){return}switch(f.keyCode){case 8:if(this.$input.is(document.activeElement)){if(this.$input.val().length||this.lastInputValue.length&&this.lastKeyDown===8){break}this.preventDeactivation=true;var d=this.$input.hasClass("tt-input")?this.$input.parent().prevAll(".token:first"):this.$input.prevAll(".token:first");if(!d.length){break}this.activate(d)}else{this.remove(f)}break;case 46:this.remove(f,"next");break}this.lastKeyUp=f.keyCode},focus:function(d){this.focused=true;this.$wrapper.addClass("focus");if(this.$input.is(document.activeElement)){this.$wrapper.find(".active").removeClass("active");this.firstActiveToken=null;if(this.options.showAutocompleteOnFocus){this.search()}}},blur:function(d){if(this.$input.is(document.activeElement)||this.$copyHelper.is(document.activeElement)){return}this.focused=false;this.$wrapper.removeClass("focus");if(!this.preventDeactivation&&!this.$element.is(document.activeElement)){this.$wrapper.find(".active").removeClass("active");this.firstActiveToken=null}if(!this.preventCreateTokens&&(this.$input.data("edit")&&!this.$input.is(document.activeElement)||this.options.createTokensOnBlur)){this.createTokensFromInput(d)}this.preventDeactivation=false;this.preventCreateTokens=false},paste:function(f){var d=this;setTimeout(function(){d.createTokensFromInput(f)},1)},change:function(d){if(d.initiator==="tokenfield"){return}this.setTokens(this.$element.val())},createTokensFromInput:function(g,f){if(this.$input.val().length<this.options.minLength){return}var d=this.getTokensList();this.setTokens(this.$input.val(),true);if(d==this.getTokensList()&&this.$input.val().length){return false}if(this.$input.hasClass("tt-input")){this.$input.typeahead("val","")}else{this.$input.val("")}if(this.$input.data("edit")){this.unedit(f)}return false},next:function(h){if(h){var d=this.$wrapper.find(".active:first"),f=d&&this.firstActiveToken?d.index()<this.firstActiveToken.index():false;if(f){return this.deactivate(d)}}var g=this.$wrapper.find(".active:last"),e=g.nextAll(".token:first");if(!e.length){this.$input.focus();return}this.activate(e,h)},prev:function(h){if(h){var d=this.$wrapper.find(".active:last"),f=d&&this.firstActiveToken?d.index()>this.firstActiveToken.index():false;if(f){return this.deactivate(d)}}var g=this.$wrapper.find(".active:first"),e=g.prevAll(".token:first");if(!e.length){e=this.$wrapper.find(".token:first")}if(!e.length&&!h){this.$input.focus();return}this.activate(e,h)},activate:function(g,j,h,k){if(!g){return}if(this.$wrapper.find(".token.active").length===this.$wrapper.find(".token").length){return}if(typeof k==="undefined"){var k=true}if(h){var j=true}this.$copyHelper.focus();if(!j){this.$wrapper.find(".active").removeClass("active");if(k){this.firstActiveToken=g}else{delete this.firstActiveToken}}if(h&&this.firstActiveToken){var f=this.firstActiveToken.index()-2,e=g.index()-2,d=this;this.$wrapper.find(".token").slice(Math.min(f,e)+1,Math.max(f,e)).each(function(){d.activate(c(this),true)})}g.addClass("active");this.$copyHelper.val(this.getTokensList(null,null,true)).select()},activateAll:function(){var d=this;this.$wrapper.find(".token").each(function(e){d.activate(c(this),e!==0,false,false)})},deactivate:function(d){if(!d){return}d.removeClass("active");this.$copyHelper.val(this.getTokensList(null,null,true)).select()},toggle:function(d){if(!d){return}d.toggleClass("active");this.$copyHelper.val(this.getTokensList(null,null,true)).select()},edit:function(i){if(!i){return}var j=i.data("value"),g=i.find(".token-label").text();var e=c.Event("tokenfield:edittoken");e.token={value:j,label:g};e.relatedTarget=i.get(0);this.$element.trigger(e);if(!e.token){return}j=e.token.value;g=e.token.label;i.find(".token-label").text(j);var f=i.outerWidth();var d=this.$input.hasClass("tt-input")?this.$input.parent():this.$input;i.replaceWith(d);this.preventCreateTokens=true;this.$input.val(j).select().data("edit",true).width(f);var h=c.Event("tokenfield:startedit");this.$element.trigger(h)},unedit:function(f){var e=this.$input.hasClass("tt-input")?this.$input.parent():this.$input;e.appendTo(this.$wrapper);this.$input.data("edit",false);this.update();if(f){var d=this;setTimeout(function(){d.$input.focus()},1)}},remove:function(j,i){if(this.$input.is(document.activeElement)||this.disabled){return}var f=(j.type==="click")?c(j.target).closest(".token"):this.$wrapper.find(".token.active");if(j.type!=="click"){if(!i){var i="prev"}this[i]();if(i==="prev"){var d=f.first().prevAll(".token:first").length===0}}var h=c.Event("tokenfield:removetoken");h.token=this.getTokenData(f);var g=c.Event("change");g.initiator="tokenfield";f.remove();this.$element.val(this.getTokensList()).trigger(h).trigger(g);if(!this.$wrapper.find(".token").length||j.type==="click"||d){this.$input.focus()}this.$input.css("width",this.options.minWidth+"px");this.update();j.preventDefault();j.stopPropagation()},update:function(i){var h=this.$input.val(),j=parseInt(this.$input.css("padding-left"),10),d=parseInt(this.$input.css("padding-right"),10),g=j+d;if(this.$input.data("edit")){if(!h){h=this.$input.prop("placeholder")}if(h===this.$mirror.text()){return}this.$mirror.text(h);var f=this.$mirror.width()+10;if(f>this.$wrapper.width()){return this.$input.width(this.$wrapper.width())}this.$input.width(f)}else{this.$input.css("width",this.options.minWidth+"px");if(this.textDirection==="rtl"){return this.$input.width(this.$input.offset().left+this.$input.outerWidth()-this.$wrapper.offset().left-parseInt(this.$wrapper.css("padding-left"),10)-g-1)}this.$input.width(this.$wrapper.offset().left+this.$wrapper.width()+parseInt(this.$wrapper.css("padding-left"),10)-this.$input.offset().left-g)}},focusInput:function(f){if(c(f.target).closest(".token").length||c(f.target).closest(".token-input").length){return}var d=this;setTimeout(function(){d.$input.focus()},0)},search:function(){if(this.$input.data("ui-autocomplete")){this.$input.autocomplete("search")}},disable:function(){this.disabled=true;this.$input.prop("disabled",true);this.$element.prop("disabled",true);this.$wrapper.addClass("disabled")},enable:function(){this.disabled=false;this.$input.prop("disabled",false);this.$element.prop("disabled",false);this.$wrapper.removeClass("disabled")},destroy:function(){this.$element.val(this.getTokensList());this.$element.css(this.$element.data("original-styles"));this.$element.prop("tabindex",this.$element.data("original-tabindex"));var d=c('label[for="'+this.$input.prop("id")+'"]');if(d.length){d.prop("for",this.$element.prop("id"))}this.$element.insertBefore(this.$wrapper);this.$element.removeData("original-styles");this.$element.removeData("original-tabindex");this.$element.removeData("bs.tokenfield");this.$wrapper.remove();var e=this.$element;delete this;return e}};var a=c.fn.tokenfield;c.fn.tokenfield=function(e,h){var g,d=[];Array.prototype.push.apply(d,arguments);var f=this.each(function(){var k=c(this),j=k.data("bs.tokenfield"),i=typeof e=="object"&&e;if(typeof e==="string"&&j&&j[e]){d.shift();g=j[e].apply(j,d)}else{if(!j&&typeof e!=="string"&&!h){k.data("bs.tokenfield",(j=new b(this,i)))}}});return typeof g!=="undefined"?g:f};c.fn.tokenfield.defaults={minWidth:60,minLength:0,allowDuplicates:false,allowEditing:true,limit:0,autocomplete:{},typeahead:{},showAutocompleteOnFocus:false,createTokensOnBlur:false,delimiter:",",beautify:true};c.fn.tokenfield.Constructor=b;c.fn.tokenfield.noConflict=function(){c.fn.tokenfield=a;return this};return b}));
