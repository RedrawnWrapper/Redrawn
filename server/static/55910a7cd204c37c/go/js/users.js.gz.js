(function(a){var b=function(c){var d=this;this.$el=c;this.$el.on("submit.users.goanimate",".user-message-form",function(g){var f=a(this);g.preventDefault();d.post(f)})};b.prototype=a.extend({},ModalBase.prototype,{post:function(f){var h=this,g=f.find('[name="subject"]'),d=f.find('[name="comment_content"]');if(g.length>0&&g.val()==""){this.alert(GT.gettext("Please enter the subject"),"error");return}if(d.val()==""){this.alert(GT.gettext("Your message is too short"),"error");return}this.alert("");var c=f.serialize();f.form("disable").find('[type="submit"]').button("loading");if(typeof Recaptcha=="object"){Recaptcha.destroy()}a.post(f.attr("action"),c,function(i){parseResponse(i);switch(responseArray.code){case"0":h.$el.modal("hide");showNotice(GT.gettext("Message sent successfully"));a(document).trigger(e=a.Event("messagePosted"));f.form("reset").find('[type="submit"]').button("done");setTimeout(function(){f.find('[type="submit"]').prop("disabled",true)},1);break;case"1":f.find(".recaptcha-container").show();f.form("enable").find('[type="submit"]').button("reset");if(typeof Recaptcha=="object"){Recaptcha.create(recaptcha_public_key,"recaptcha",a.extend({},recaptcha_options,{callback:Recaptcha.focus_response_field}))}break;default:h.alert(responseArray.json.error,"error");f.form("enable").find('[type="submit"]').button("reset");break}resetResponse()})}});a(document).on("click",'[data-action="users-message"]',function(g){var f=a(this),c=ModalBase.ensure("users-message"),d=c.data("sendMessage");if(!d){c.data("sendMessage",d=new b(c))}g.preventDefault();d.load(f.data("remote"))})})(jQuery);
